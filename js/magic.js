
(function(){

  var vim_included = false;
  var success = false;

function start(){
  console.log('starting');
  success = false;
  var check = 0;
  var loopintval;

  var intval = window.setInterval(function(){

    // if the CodeMirror isn't online in 15 seconds....it probably won't be....
    check++;
    if (check >= 100) window.clearInterval(intval);
    if (typeof window.CodeMirror == "undefined") return;

    window.clearInterval(intval);

    // if vim hasn't been included on this page it...lets include it...
    if (!vim_included){
      vim_included = true;
      // include vim.js for CodeMirror
      (function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../lib/codemirror"),require("../addon/search/searchcursor"),require("../addon/dialog/dialog"),require("../addon/edit/matchbrackets.js"))}else{if(typeof define=="function"&&define.amd){define(["../lib/codemirror","../addon/search/searchcursor","../addon/dialog/dialog","../addon/edit/matchbrackets"],a)}else{a(CodeMirror)}}})(function(b){var a=[{keys:"<Left>",type:"keyToKey",toKeys:"h"},{keys:"<Right>",type:"keyToKey",toKeys:"l"},{keys:"<Up>",type:"keyToKey",toKeys:"k"},{keys:"<Down>",type:"keyToKey",toKeys:"j"},{keys:"<Space>",type:"keyToKey",toKeys:"l"},{keys:"<BS>",type:"keyToKey",toKeys:"h",context:"normal"},{keys:"<C-Space>",type:"keyToKey",toKeys:"W"},{keys:"<C-BS>",type:"keyToKey",toKeys:"B",context:"normal"},{keys:"<S-Space>",type:"keyToKey",toKeys:"w"},{keys:"<S-BS>",type:"keyToKey",toKeys:"b",context:"normal"},{keys:"<C-n>",type:"keyToKey",toKeys:"j"},{keys:"<C-p>",type:"keyToKey",toKeys:"k"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"s",type:"keyToKey",toKeys:"cl",context:"normal"},{keys:"s",type:"keyToKey",toKeys:"c",context:"visual"},{keys:"S",type:"keyToKey",toKeys:"cc",context:"normal"},{keys:"S",type:"keyToKey",toKeys:"VdO",context:"visual"},{keys:"<Home>",type:"keyToKey",toKeys:"0"},{keys:"<End>",type:"keyToKey",toKeys:"$"},{keys:"<PageUp>",type:"keyToKey",toKeys:"<C-b>"},{keys:"<PageDown>",type:"keyToKey",toKeys:"<C-f>"},{keys:"<CR>",type:"keyToKey",toKeys:"j^",context:"normal"},{keys:"H",type:"motion",motion:"moveToTopLine",motionArgs:{linewise:true,toJumplist:true}},{keys:"M",type:"motion",motion:"moveToMiddleLine",motionArgs:{linewise:true,toJumplist:true}},{keys:"L",type:"motion",motion:"moveToBottomLine",motionArgs:{linewise:true,toJumplist:true}},{keys:"h",type:"motion",motion:"moveByCharacters",motionArgs:{forward:false}},{keys:"l",type:"motion",motion:"moveByCharacters",motionArgs:{forward:true}},{keys:"j",type:"motion",motion:"moveByLines",motionArgs:{forward:true,linewise:true}},{keys:"k",type:"motion",motion:"moveByLines",motionArgs:{forward:false,linewise:true}},{keys:"gj",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:true}},{keys:"gk",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:false}},{keys:"w",type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:false}},{keys:"W",type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:false,bigWord:true}},{keys:"e",type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:true,inclusive:true}},{keys:"E",type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:true,bigWord:true,inclusive:true}},{keys:"b",type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:false}},{keys:"B",type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:false,bigWord:true}},{keys:"ge",type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:true,inclusive:true}},{keys:"gE",type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:true,bigWord:true,inclusive:true}},{keys:"{",type:"motion",motion:"moveByParagraph",motionArgs:{forward:false,toJumplist:true}},{keys:"}",type:"motion",motion:"moveByParagraph",motionArgs:{forward:true,toJumplist:true}},{keys:"<C-f>",type:"motion",motion:"moveByPage",motionArgs:{forward:true}},{keys:"<C-b>",type:"motion",motion:"moveByPage",motionArgs:{forward:false}},{keys:"<C-d>",type:"motion",motion:"moveByScroll",motionArgs:{forward:true,explicitRepeat:true}},{keys:"<C-u>",type:"motion",motion:"moveByScroll",motionArgs:{forward:false,explicitRepeat:true}},{keys:"gg",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:false,explicitRepeat:true,linewise:true,toJumplist:true}},{keys:"G",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:true,explicitRepeat:true,linewise:true,toJumplist:true}},{keys:"0",type:"motion",motion:"moveToStartOfLine"},{keys:"^",type:"motion",motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"+",type:"motion",motion:"moveByLines",motionArgs:{forward:true,toFirstChar:true}},{keys:"-",type:"motion",motion:"moveByLines",motionArgs:{forward:false,toFirstChar:true}},{keys:"_",type:"motion",motion:"moveByLines",motionArgs:{forward:true,toFirstChar:true,repeatOffset:-1}},{keys:"$",type:"motion",motion:"moveToEol",motionArgs:{inclusive:true}},{keys:"%",type:"motion",motion:"moveToMatchedSymbol",motionArgs:{inclusive:true,toJumplist:true}},{keys:"f<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:true,inclusive:true}},{keys:"F<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:false}},{keys:"t<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:true,inclusive:true}},{keys:"T<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:false}},{keys:";",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:true}},{keys:",",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:false}},{keys:"'<character>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:true,linewise:true}},{keys:"`<character>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:true}},{keys:"]`",type:"motion",motion:"jumpToMark",motionArgs:{forward:true}},{keys:"[`",type:"motion",motion:"jumpToMark",motionArgs:{forward:false}},{keys:"]'",type:"motion",motion:"jumpToMark",motionArgs:{forward:true,linewise:true}},{keys:"['",type:"motion",motion:"jumpToMark",motionArgs:{forward:false,linewise:true}},{keys:"]p",type:"action",action:"paste",isEdit:true,actionArgs:{after:true,isEdit:true,matchIndent:true}},{keys:"[p",type:"action",action:"paste",isEdit:true,actionArgs:{after:false,isEdit:true,matchIndent:true}},{keys:"]<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:true,toJumplist:true}},{keys:"[<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:false,toJumplist:true}},{keys:"|",type:"motion",motion:"moveToColumn"},{keys:"o",type:"motion",motion:"moveToOtherHighlightedEnd",context:"visual"},{keys:"O",type:"motion",motion:"moveToOtherHighlightedEnd",motionArgs:{sameLine:true},context:"visual"},{keys:"d",type:"operator",operator:"delete"},{keys:"y",type:"operator",operator:"yank"},{keys:"c",type:"operator",operator:"change"},{keys:">",type:"operator",operator:"indent",operatorArgs:{indentRight:true}},{keys:"<",type:"operator",operator:"indent",operatorArgs:{indentRight:false}},{keys:"g~",type:"operator",operator:"changeCase"},{keys:"gu",type:"operator",operator:"changeCase",operatorArgs:{toLower:true},isEdit:true},{keys:"gU",type:"operator",operator:"changeCase",operatorArgs:{toLower:false},isEdit:true},{keys:"n",type:"motion",motion:"findNext",motionArgs:{forward:true,toJumplist:true}},{keys:"N",type:"motion",motion:"findNext",motionArgs:{forward:false,toJumplist:true}},{keys:"x",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:true},operatorMotionArgs:{visualLine:false}},{keys:"X",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:false},operatorMotionArgs:{visualLine:true}},{keys:"D",type:"operatorMotion",operator:"delete",motion:"moveToEol",motionArgs:{inclusive:true},context:"normal"},{keys:"D",type:"operator",operator:"delete",operatorArgs:{linewise:true},context:"visual"},{keys:"Y",type:"operatorMotion",operator:"yank",motion:"moveToEol",motionArgs:{inclusive:true},context:"normal"},{keys:"Y",type:"operator",operator:"yank",operatorArgs:{linewise:true},context:"visual"},{keys:"C",type:"operatorMotion",operator:"change",motion:"moveToEol",motionArgs:{inclusive:true},context:"normal"},{keys:"C",type:"operator",operator:"change",operatorArgs:{linewise:true},context:"visual"},{keys:"~",type:"operatorMotion",operator:"changeCase",motion:"moveByCharacters",motionArgs:{forward:true},operatorArgs:{shouldMoveCursor:true},context:"normal"},{keys:"~",type:"operator",operator:"changeCase",context:"visual"},{keys:"<C-w>",type:"operatorMotion",operator:"delete",motion:"moveByWords",motionArgs:{forward:false,wordEnd:false},context:"insert"},{keys:"<C-i>",type:"action",action:"jumpListWalk",actionArgs:{forward:true}},{keys:"<C-o>",type:"action",action:"jumpListWalk",actionArgs:{forward:false}},{keys:"<C-e>",type:"action",action:"scroll",actionArgs:{forward:true,linewise:true}},{keys:"<C-y>",type:"action",action:"scroll",actionArgs:{forward:false,linewise:true}},{keys:"a",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"charAfter"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"eol"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"endOfSelectedArea"},context:"visual"},{keys:"i",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"inplace"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"firstNonBlank"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"startOfSelectedArea"},context:"visual"},{keys:"o",type:"action",action:"newLineAndEnterInsertMode",isEdit:true,interlaceInsertRepeat:true,actionArgs:{after:true},context:"normal"},{keys:"O",type:"action",action:"newLineAndEnterInsertMode",isEdit:true,interlaceInsertRepeat:true,actionArgs:{after:false},context:"normal"},{keys:"v",type:"action",action:"toggleVisualMode"},{keys:"V",type:"action",action:"toggleVisualMode",actionArgs:{linewise:true}},{keys:"<C-v>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:true}},{keys:"<C-q>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:true}},{keys:"gv",type:"action",action:"reselectLastSelection"},{keys:"J",type:"action",action:"joinLines",isEdit:true},{keys:"p",type:"action",action:"paste",isEdit:true,actionArgs:{after:true,isEdit:true}},{keys:"P",type:"action",action:"paste",isEdit:true,actionArgs:{after:false,isEdit:true}},{keys:"r<character>",type:"action",action:"replace",isEdit:true},{keys:"@<character>",type:"action",action:"replayMacro"},{keys:"q<character>",type:"action",action:"enterMacroRecordMode"},{keys:"R",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{replace:true}},{keys:"u",type:"action",action:"undo",context:"normal"},{keys:"u",type:"operator",operator:"changeCase",operatorArgs:{toLower:true},context:"visual",isEdit:true},{keys:"U",type:"operator",operator:"changeCase",operatorArgs:{toLower:false},context:"visual",isEdit:true},{keys:"<C-r>",type:"action",action:"redo"},{keys:"m<character>",type:"action",action:"setMark"},{keys:'"<character>',type:"action",action:"setRegister"},{keys:"zz",type:"action",action:"scrollToCursor",actionArgs:{position:"center"}},{keys:"z.",type:"action",action:"scrollToCursor",actionArgs:{position:"center"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"zt",type:"action",action:"scrollToCursor",actionArgs:{position:"top"}},{keys:"z<CR>",type:"action",action:"scrollToCursor",actionArgs:{position:"top"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"z-",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"}},{keys:"zb",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:".",type:"action",action:"repeatLastEdit"},{keys:"<C-a>",type:"action",action:"incrementNumberToken",isEdit:true,actionArgs:{increase:true,backtrack:false}},{keys:"<C-x>",type:"action",action:"incrementNumberToken",isEdit:true,actionArgs:{increase:false,backtrack:false}},{keys:"a<character>",type:"motion",motion:"textObjectManipulation"},{keys:"i<character>",type:"motion",motion:"textObjectManipulation",motionArgs:{textObjectInner:true}},{keys:"/",type:"search",searchArgs:{forward:true,querySrc:"prompt",toJumplist:true}},{keys:"?",type:"search",searchArgs:{forward:false,querySrc:"prompt",toJumplist:true}},{keys:"*",type:"search",searchArgs:{forward:true,querySrc:"wordUnderCursor",wholeWordOnly:true,toJumplist:true}},{keys:"#",type:"search",searchArgs:{forward:false,querySrc:"wordUnderCursor",wholeWordOnly:true,toJumplist:true}},{keys:"g*",type:"search",searchArgs:{forward:true,querySrc:"wordUnderCursor",toJumplist:true}},{keys:"g#",type:"search",searchArgs:{forward:false,querySrc:"wordUnderCursor",toJumplist:true}},{keys:":",type:"ex"}];var e=[{name:"colorscheme",shortName:"colo"},{name:"map"},{name:"imap",shortName:"im"},{name:"nmap",shortName:"nm"},{name:"vmap",shortName:"vm"},{name:"unmap"},{name:"write",shortName:"w"},{name:"undo",shortName:"u"},{name:"redo",shortName:"red"},{name:"set",shortName:"se"},{name:"set",shortName:"se"},{name:"setlocal",shortName:"setl"},{name:"setglobal",shortName:"setg"},{name:"sort",shortName:"sor"},{name:"substitute",shortName:"s",possiblyAsync:true},{name:"nohlsearch",shortName:"noh"},{name:"yank",shortName:"y"},{name:"delmarks",shortName:"delm"},{name:"registers",shortName:"reg",excludeFromCommandHistory:true},{name:"global",shortName:"g"}];var d=b.Pos;var f=function(){function aZ(bG){bG.setOption("disableInput",true);bG.setOption("showCursorWhenSelecting",false);b.signal(bG,"vim-mode-change",{mode:"normal"});bG.on("cursorActivity",ac);H(bG);b.on(bG.getInputField(),"paste",V(bG))}function aV(bG){bG.setOption("disableInput",false);bG.off("cursorActivity",ac);b.off(bG.getInputField(),"paste",V(bG));bG.state.vim=null}function j(bG,bH){if(this==b.keyMap.vim){b.rmClass(bG.getWrapperElement(),"cm-fat-cursor")}if(!bH||bH.attach!=u){aV(bG,false)}}function u(bG,bH){if(this==b.keyMap.vim){b.addClass(bG.getWrapperElement(),"cm-fat-cursor")}if(!bH||bH.attach!=u){aZ(bG)}}b.defineOption("vimMode",false,function(bG,bI,bH){if(bI&&bG.getOption("keyMap")!="vim"){bG.setOption("keyMap","vim")}else{if(!bI&&bH!=b.Init&&/^vim/.test(bG.getOption("keyMap"))){bG.setOption("keyMap","default")}}});function a7(bI,bH){if(!bH){return undefined}var bG=M(bI);if(!bG){return false}var bJ=b.Vim.findKey(bH,bG);if(typeof bJ=="function"){b.signal(bH,"vim-keypress",bG)}return bJ}var aE={Shift:"S",Ctrl:"C",Alt:"A",Cmd:"D",Mod:"A"};var aY={Enter:"CR",Backspace:"BS",Delete:"Del"};function M(bI){if(bI.charAt(0)=="'"){return bI.charAt(1)}var bL=bI.split(/-(?!$)/);var bG=bL[bL.length-1];if(bL.length==1&&bL[0].length==1){return false}else{if(bL.length==2&&bL[0]=="Shift"&&bG.length==1){return false}}var bK=false;for(var bH=0;bH<bL.length;bH++){var bJ=bL[bH];if(bJ in aE){bL[bH]=aE[bJ]}else{bK=true}if(bJ in aY){bL[bH]=aY[bJ]}}if(!bK){return false}if(C(bG)){bL[bL.length-1]=bG.toLowerCase()}return"<"+bL.join("-")+">"}function V(bG){var bH=bG.state.vim;if(!bH.onPasteFn){bH.onPasteFn=function(){if(!bH.insertMode){bG.setCursor(E(bG.getCursor(),0,1));r.enterInsertMode(bG,{},bH)}}}return bH.onPasteFn}var a3=/[\d]/;var ar=[b.isWordChar,function(bG){return bG&&!b.isWordChar(bG)&&!/\s/.test(bG)}],bA=[function(bG){return/\S/.test(bG)}];function av(bJ,bH){var bI=[];for(var bG=bJ;bG<bJ+bH;bG++){bI.push(String.fromCharCode(bG))}return bI}var ak=av(65,26);var ap=av(97,26);var W=av(48,10);var aJ=[].concat(ak,ap,W,["<",">"]);var m=[].concat(ak,ap,W,["-",'"',".",":","/"]);function h(bG,bH){return bH>=bG.firstLine()&&bH<=bG.lastLine()}function F(bG){return(/^[a-z]$/).test(bG)}function O(bG){return"()[]{}".indexOf(bG)!=-1}function aj(bG){return a3.test(bG)}function C(bG){return(/^[A-Z]$/).test(bG)}function U(bG){return(/^\s*$/).test(bG)}function K(bI,bG){for(var bH=0;bH<bG.length;bH++){if(bG[bH]==bI){return true}}return false}var ax={};function aO(bI,bH,bK,bG,bL){if(bH===undefined&&!bL){throw Error("defaultValue is required unless callback is provided")}if(!bK){bK="string"}ax[bI]={type:bK,defaultValue:bH,callback:bL};if(bG){for(var bJ=0;bJ<bG.length;bJ++){ax[bG[bJ]]=ax[bI]}}if(bH){aM(bI,bH)}}function aM(bI,bL,bG,bH){var bK=ax[bI];bH=bH||{};var bJ=bH.scope;if(!bK){throw Error("Unknown option: "+bI)}if(bK.type=="boolean"){if(bL&&bL!==true){throw Error("Invalid argument: "+bI+"="+bL)}else{if(bL!==false){bL=true}}}if(bK.callback){if(bJ!=="local"){bK.callback(bL,undefined)}if(bJ!=="global"&&bG){bK.callback(bL,bG)}}else{if(bJ!=="local"){bK.value=bK.type=="boolean"?!!bL:bL}if(bJ!=="global"&&bG){bG.state.vim.options[bI]={value:bL}}}}function p(bI,bG,bH){var bL=ax[bI];bH=bH||{};var bK=bH.scope;if(!bL){throw Error("Unknown option: "+bI)}if(bL.callback){var bJ=bG&&bL.callback(undefined,bG);if(bK!=="global"&&bJ!==undefined){return bJ}if(bK!=="local"){return bL.callback()}return}else{var bJ=(bK!=="global")&&(bG&&bG.state.vim.options[bI]);return(bJ||(bK!=="local")&&bL||{}).value}}aO("filetype",undefined,"string",["ft"],function(bH,bG){if(bG===undefined){return}if(bH===undefined){var bI=bG.getOption("mode");return bI=="null"?"":bI}else{var bI=bH==""?"null":bH;bG.setOption("mode",bI)}});var at=function(){var bK=100;var bM=-1;var bJ=0;var bI=0;var bH=new Array(bK);function bL(bN,bP,bQ){var bR=bM%bK;var bS=bH[bR];function bO(bV){var bU=++bM%bK;var bW=bH[bU];if(bW){bW.clear()}bH[bU]=bN.setBookmark(bV)}if(bS){var bT=bS.find();if(bT&&!bD(bT,bP)){bO(bP)}}else{bO(bP)}bO(bQ);bJ=bM;bI=bM-bK+1;if(bI<0){bI=0}}function bG(bN,bR){bM+=bR;if(bM>bJ){bM=bJ}else{if(bM<bI){bM=bI}}var bS=bH[(bK+bM)%bK];if(bS&&!bS.find()){var bQ=bR>0?1:-1;var bP;var bO=bN.getCursor();do{bM+=bQ;bS=bH[(bK+bM)%bK];if(bS&&(bP=bS.find())&&!bD(bO,bP)){break}}while(bM<bJ&&bM>bI)}return bS}return{cachedCursor:undefined,add:bL,move:bG}};var k=function(bG){if(bG){return{changes:bG.changes,expectCursorActivityForChange:bG.expectCursorActivityForChange}}return{changes:[],expectCursorActivityForChange:false}};function aB(){this.latestRegister=undefined;this.isPlaying=false;this.isRecording=false;this.replaySearchQueries=[];this.onRecordingDone=undefined;this.lastInsertModeChanges=k()}aB.prototype={exitMacroRecordMode:function(){var bG=s.macroModeState;if(bG.onRecordingDone){bG.onRecordingDone()}bG.onRecordingDone=undefined;bG.isRecording=false},enterMacroRecordMode:function(bG,bI){var bH=s.registerController.getRegister(bI);if(bH){bH.clear();this.latestRegister=bI;if(bG.openDialog){this.onRecordingDone=bG.openDialog("(recording)["+bI+"]",null,{bottom:true})}this.isRecording=true}}};function H(bG){if(!bG.state.vim){bG.state.vim={inputState:new aF(),lastEditInputState:undefined,lastEditActionCommand:undefined,lastHPos:-1,lastHSPos:-1,lastMotion:null,marks:{},fakeCursor:null,insertMode:false,insertModeRepeat:undefined,visualMode:false,visualLine:false,visualBlock:false,lastSelection:null,lastPastedText:null,sel:{},options:{}}}return bG.state.vim}var s;function B(){s={searchQuery:null,searchIsReversed:false,lastSubstituteReplacePart:undefined,jumpList:at(),macroModeState:new aB,lastCharacterSearch:{increment:0,forward:true,selectedCharacter:""},registerController:new al({}),searchHistoryController:new a8({}),exCommandHistoryController:new a8({})};for(var bG in ax){var bH=ax[bG];bH.value=bH.defaultValue}}var bB;var aS={buildKeyMap:function(){},getRegisterController:function(){return s.registerController},resetVimGlobalState_:B,getVimGlobalState_:function(){return s},maybeInitVimState_:H,suppressErrorLogging:false,InsertModeKey:bp,map:function(bH,bI,bG){n.map(bH,bI,bG)},unmap:function(bH,bG){n.unmap(bH,bG)},setOption:aM,getOption:p,defineOption:aO,defineEx:function(bG,bI,bH){if(!bI){bI=bG}else{if(bG.indexOf(bI)!==0){throw new Error('(Vim.defineEx) "'+bI+'" is not a prefix of "'+bG+'", command not registered')}}a9[bG]=bH;n.commandMap_[bI]={name:bG,shortName:bI,type:"api"}},handleKey:function(bG,bI,bH){var bJ=this.findKey(bG,bI,bH);if(typeof bJ==="function"){return bJ()}},findKey:function(bM,bN,bL){var bJ=H(bM);function bO(){var bQ=s.macroModeState;if(bQ.isRecording){if(bN=="q"){bQ.exitMacroRecordMode();l(bM);return true}if(bL!="mapping"){J(bQ,bN)}}}function bP(){if(bN=="<Esc>"){l(bM);if(bJ.visualMode){aW(bM)}else{if(bJ.insertMode){x(bM)}}return true}}function bG(bR){var bQ;while(bR){bQ=(/<\w+-.+?>|<\w+>|./).exec(bR);bN=bQ[0];bR=bR.substring(bQ.index+bN.length);b.Vim.handleKey(bM,bN,"mapping")}}function bK(){if(bP()){return true}var bS=bJ.inputState.keyBuffer=bJ.inputState.keyBuffer+bN;var bT=bN.length==1;var bQ=bg.matchCommand(bS,a,bJ.inputState,"insert");while(bS.length>1&&bQ.type!="full"){var bS=bJ.inputState.keyBuffer=bS.slice(1);var bU=bg.matchCommand(bS,a,bJ.inputState,"insert");if(bU.type!="none"){bQ=bU}}if(bQ.type=="none"){l(bM);return false}else{if(bQ.type=="partial"){if(bB){window.clearTimeout(bB)}bB=window.setTimeout(function(){if(bJ.insertMode&&bJ.inputState.keyBuffer){l(bM)}},p("insertModeEscKeysTimeout"));return !bT}}if(bB){window.clearTimeout(bB)}if(bT){var bR=bM.getCursor();bM.replaceRange("",E(bR,0,-(bS.length-1)),bR,"+input")}l(bM);return bQ.command}function bI(){if(bO()||bP()){return true}var bS=bJ.inputState.keyBuffer=bJ.inputState.keyBuffer+bN;if(/^[1-9]\d*$/.test(bS)){return true}var bT=/^(\d*)(.*)$/.exec(bS);if(!bT){l(bM);return false}var bR=bJ.visualMode?"visual":"normal";var bQ=bg.matchCommand(bT[2]||bT[1],a,bJ.inputState,bR);if(bQ.type=="none"){l(bM);return false}else{if(bQ.type=="partial"){return true}}bJ.inputState.keyBuffer="";var bT=/^(\d*)(.*)$/.exec(bS);if(bT[1]&&bT[1]!="0"){bJ.inputState.pushRepeatDigit(bT[1])}return bQ.command}var bH;if(bJ.insertMode){bH=bK()}else{bH=bI()}if(bH===false){return undefined}else{if(bH===true){return function(){}}else{return function(){return bM.operation(function(){bM.curOp.isVimOp=true;try{if(bH.type=="keyToKey"){bG(bH.toKeys)}else{bg.processCommand(bM,bJ,bH)}}catch(bQ){bM.state.vim=undefined;H(bM);if(!b.Vim.suppressErrorLogging){console.log(bQ)}throw bQ}return true})}}}},handleEx:function(bG,bH){n.processCommand(bG,bH)},defineMotion:au,defineAction:bu,defineOperator:bn,mapCommand:aC,_mapCommand:q,defineRegister:Y,exitVisualMode:aW,exitInsertMode:x};function aF(){this.prefixRepeat=[];this.motionRepeat=[];this.operator=null;this.operatorArgs=null;this.motion=null;this.motionArgs=null;this.keyBuffer=[];this.registerName=null}aF.prototype.pushRepeatDigit=function(bG){if(!this.operator){this.prefixRepeat=this.prefixRepeat.concat(bG)}else{this.motionRepeat=this.motionRepeat.concat(bG)}};aF.prototype.getRepeat=function(){var bG=0;if(this.prefixRepeat.length>0||this.motionRepeat.length>0){bG=1;if(this.prefixRepeat.length>0){bG*=parseInt(this.prefixRepeat.join(""),10)}if(this.motionRepeat.length>0){bG*=parseInt(this.motionRepeat.join(""),10)}}return bG};function l(bG,bH){bG.state.vim.inputState=new aF();b.signal(bG,"vim-command-done",bH)}function bt(bI,bH,bG){this.clear();this.keyBuffer=[bI||""];this.insertModeChanges=[];this.searchQueries=[];this.linewise=!!bH;this.blockwise=!!bG}bt.prototype={setText:function(bI,bH,bG){this.keyBuffer=[bI||""];this.linewise=!!bH;this.blockwise=!!bG},pushText:function(bH,bG){if(bG){if(!this.linewise){this.keyBuffer.push("\n")}this.linewise=true}this.keyBuffer.push(bH)},pushInsertModeChanges:function(bG){this.insertModeChanges.push(k(bG))},pushSearchQuery:function(bG){this.searchQueries.push(bG)},clear:function(){this.keyBuffer=[];this.insertModeChanges=[];this.searchQueries=[];this.linewise=false},toString:function(){return this.keyBuffer.join("")}};function Y(bH,bI){var bG=s.registerController.registers[bH];if(!bH||bH.length!=1){throw Error("Register name must be 1 character")}if(bG[bH]){throw Error("Register already defined "+bH)}bG[bH]=bI;m.push(bH)}function al(bG){this.registers=bG;this.unnamedRegister=bG['"']=new bt();bG["."]=new bt();bG[":"]=new bt();bG["/"]=new bt()}al.prototype={pushText:function(bK,bH,bM,bL,bI){if(bL&&bM.charAt(0)=="\n"){bM=bM.slice(1)+"\n"}if(bL&&bM.charAt(bM.length-1)!=="\n"){bM+="\n"}var bJ=this.isValidRegister(bK)?this.getRegister(bK):null;if(!bJ){switch(bH){case"yank":this.registers["0"]=new bt(bM,bL,bI);break;case"delete":case"change":if(bM.indexOf("\n")==-1){this.registers["-"]=new bt(bM,bL)}else{this.shiftNumericRegisters_();this.registers["1"]=new bt(bM,bL)}break}this.unnamedRegister.setText(bM,bL,bI);return}var bG=C(bK);if(bG){bJ.pushText(bM,bL)}else{bJ.setText(bM,bL,bI)}this.unnamedRegister.setText(bJ.toString(),bL)},getRegister:function(bG){if(!this.isValidRegister(bG)){return this.unnamedRegister}bG=bG.toLowerCase();if(!this.registers[bG]){this.registers[bG]=new bt()}return this.registers[bG]},isValidRegister:function(bG){return bG&&K(bG,m)},shiftNumericRegisters_:function(){for(var bG=9;bG>=2;bG--){this.registers[bG]=this.getRegister(""+(bG-1))}}};function a8(){this.historyBuffer=[];this.iterator=0;this.initialPrefix=null}a8.prototype={nextMatch:function(bH,bG){var bM=this.historyBuffer;var bJ=bG?-1:1;if(this.initialPrefix===null){this.initialPrefix=bH}for(var bL=this.iterator+bJ;bG?bL>=0:bL<bM.length;bL+=bJ){var bK=bM[bL];for(var bI=0;bI<=bK.length;bI++){if(this.initialPrefix==bK.substring(0,bI)){this.iterator=bL;return bK}}}if(bL>=bM.length){this.iterator=bM.length;return this.initialPrefix}if(bL<0){return bH}},pushInput:function(bG){var bH=this.historyBuffer.indexOf(bG);if(bH>-1){this.historyBuffer.splice(bH,1)}if(bG.length){this.historyBuffer.push(bG)}},reset:function(){this.initialPrefix=null;this.iterator=this.historyBuffer.length}};var bg={matchCommand:function(bL,bN,bG,bJ){var bM=bq(bL,bN,bJ,bG);if(!bM.full&&!bM.partial){return{type:"none"}}else{if(!bM.full&&bM.partial){return{type:"partial"}}}var bK;for(var bI=0;bI<bM.full.length;bI++){var bH=bM.full[bI];if(!bK){bK=bH}}if(bK.keys.slice(-11)=="<character>"){bG.selectedCharacter=R(bL)}return{type:"full",command:bK}},processCommand:function(bG,bH,bI){bH.inputState.repeatOverride=bI.repeatOverride;switch(bI.type){case"motion":this.processMotion(bG,bH,bI);break;case"operator":this.processOperator(bG,bH,bI);break;case"operatorMotion":this.processOperatorMotion(bG,bH,bI);break;case"action":this.processAction(bG,bH,bI);break;case"search":this.processSearch(bG,bH,bI);break;case"ex":case"keyToEx":this.processEx(bG,bH,bI);break;default:break}},processMotion:function(bG,bH,bI){bH.inputState.motion=bI.motion;bH.inputState.motionArgs=bo(bI.motionArgs);this.evalInput(bG,bH)},processOperator:function(bH,bI,bJ){var bG=bI.inputState;if(bG.operator){if(bG.operator==bJ.operator){bG.motion="expandToLine";bG.motionArgs={linewise:true};this.evalInput(bH,bI);return}else{l(bH)}}bG.operator=bJ.operator;bG.operatorArgs=bo(bJ.operatorArgs);if(bI.visualMode){this.evalInput(bH,bI)}},processOperatorMotion:function(bG,bJ,bK){var bI=bJ.visualMode;var bH=bo(bK.operatorMotionArgs);if(bH){if(bI&&bH.visualLine){bJ.visualLine=true}}this.processOperator(bG,bJ,bK);if(!bI){this.processMotion(bG,bJ,bK)}},processAction:function(bH,bJ,bM){var bG=bJ.inputState;var bL=bG.getRepeat();var bK=!!bL;var bI=bo(bM.actionArgs)||{};if(bG.selectedCharacter){bI.selectedCharacter=bG.selectedCharacter}if(bM.operator){this.processOperator(bH,bJ,bM)}if(bM.motion){this.processMotion(bH,bJ,bM)}if(bM.motion||bM.operator){this.evalInput(bH,bJ)}bI.repeat=bL||1;bI.repeatIsExplicit=bK;bI.registerName=bG.registerName;l(bH);bJ.lastMotion=null;if(bM.isEdit){this.recordLastEdit(bJ,bG,bM)}r[bM.action](bH,bI,bJ)},processSearch:function(bV,bO,bN){if(!bV.getSearchCursor){return}var bQ=bN.searchArgs.forward;var bL=bN.searchArgs.wholeWordOnly;aL(bV).setReversed(!bQ);var bR=(bQ)?"/":"?";var bT=aL(bV).getQuery();var bI=bV.getScrollInfo();function bM(bY,bW,bX){s.searchHistoryController.pushInput(bY);s.searchHistoryController.reset();try{bC(bV,bY,bW,bX)}catch(bZ){br(bV,"Invalid regex: "+bY);l(bV);return}bg.processMotion(bV,bO,{type:"motion",motion:"findNext",motionArgs:{forward:true,toJumplist:bN.searchArgs.toJumplist}})}function bU(bW){bV.scrollTo(bI.left,bI.top);bM(bW,true,true);var bX=s.macroModeState;if(bX.isRecording){P(bX,bW)}}function bK(b0,bZ,b1){var bY=b.keyName(b0),bW;if(bY=="Up"||bY=="Down"){bW=bY=="Up"?true:false;bZ=s.searchHistoryController.nextMatch(bZ,bW)||"";b1(bZ)}else{if(bY!="Left"&&bY!="Right"&&bY!="Ctrl"&&bY!="Alt"&&bY!="Shift"){s.searchHistoryController.reset()}}var bX;try{bX=bC(bV,bZ,true,true)}catch(b0){}if(bX){bV.scrollIntoView(bE(bV,!bQ,bX),30)}else{aP(bV);bV.scrollTo(bI.left,bI.top)}}function bH(bY,bX,bZ){var bW=b.keyName(bY);if(bW=="Esc"||bW=="Ctrl-C"||bW=="Ctrl-["||(bW=="Backspace"&&bX=="")){s.searchHistoryController.pushInput(bX);s.searchHistoryController.reset();bC(bV,bT);aP(bV);bV.scrollTo(bI.left,bI.top);b.e_stop(bY);l(bV);bZ();bV.focus()}else{if(bW=="Ctrl-U"){b.e_stop(bY);bZ("")}}}switch(bN.searchArgs.querySrc){case"prompt":var bP=s.macroModeState;if(bP.isPlaying){var bS=bP.replaySearchQueries.shift();bM(bS,true,false)}else{a5(bV,{onClose:bU,prefix:bR,desc:Q,onKeyUp:bK,onKeyDown:bH})}break;case"wordUnderCursor":var bJ=aI(bV,false,true,false,true);var bG=true;if(!bJ){bJ=aI(bV,false,true,false,false);bG=false}if(!bJ){return}var bS=bV.getLine(bJ.start.line).substring(bJ.start.ch,bJ.end.ch);if(bG&&bL){bS="\\b"+bS+"\\b"}else{bS=i(bS)}s.jumpList.cachedCursor=bV.getCursor();bV.setCursor(bJ.start);bM(bS,true,false);break}},processEx:function(bG,bH,bK){function bJ(bL){s.exCommandHistoryController.pushInput(bL);s.exCommandHistoryController.reset();n.processCommand(bG,bL)}function bI(bO,bM,bP){var bN=b.keyName(bO),bL;if(bN=="Esc"||bN=="Ctrl-C"||bN=="Ctrl-["||(bN=="Backspace"&&bM=="")){s.exCommandHistoryController.pushInput(bM);s.exCommandHistoryController.reset();b.e_stop(bO);l(bG);bP();bG.focus()}if(bN=="Up"||bN=="Down"){bL=bN=="Up"?true:false;bM=s.exCommandHistoryController.nextMatch(bM,bL)||"";bP(bM)}else{if(bN=="Ctrl-U"){b.e_stop(bO);bP("")}else{if(bN!="Left"&&bN!="Right"&&bN!="Ctrl"&&bN!="Alt"&&bN!="Shift"){s.exCommandHistoryController.reset()}}}}if(bK.type=="keyToEx"){n.processCommand(bG,bK.exArgs.input)}else{if(bH.visualMode){a5(bG,{onClose:bJ,prefix:":",value:"'<,'>",onKeyDown:bI})}else{a5(bG,{onClose:bJ,prefix:":",onKeyDown:bI})}}},evalInput:function(bO,b0){var bT=b0.inputState;var bX=bT.motion;var bU=bT.motionArgs||{};var bP=bT.operator;var ca=bT.operatorArgs||{};var bV=bT.registerName;var b1=b0.sel;var cb=D(b0.visualMode?ab(bO,b1.head):bO.getCursor("head"));var bM=D(b0.visualMode?ab(bO,b1.anchor):bO.getCursor("anchor"));var bJ=D(cb);var bI=D(bM);var bZ,bS;var bQ;if(bP){this.recordLastEdit(b0,bT)}if(bT.repeatOverride!==undefined){bQ=bT.repeatOverride}else{bQ=bT.getRepeat()}if(bQ>0&&bU.explicitRepeat){bU.repeatIsExplicit=true}else{if(bU.noRepeat||(!bU.explicitRepeat&&bQ===0)){bQ=1;bU.repeatIsExplicit=false}}if(bT.selectedCharacter){bU.selectedCharacter=ca.selectedCharacter=bT.selectedCharacter}bU.repeat=bQ;l(bO);if(bX){var bY=a6[bX](bO,cb,bU,b0);b0.lastMotion=a6[bX];if(!bY){return}if(bU.toJumplist){var b9=s.jumpList;var bR=b9.cachedCursor;if(bR){bk(bO,bR,bY);delete b9.cachedCursor}else{bk(bO,cb,bY)}}if(bY instanceof Array){bS=bY[0];bZ=bY[1]}else{bZ=bY}if(!bZ){bZ=D(cb)}if(b0.visualMode){if(!(b0.visualBlock&&bZ.ch===Infinity)){bZ=ab(bO,bZ,b0.visualBlock)}if(bS){bS=ab(bO,bS,true)}bS=bS||bI;b1.anchor=bS;b1.head=bZ;N(bO);aU(bO,b0,"<",aR(bS,bZ)?bS:bZ);aU(bO,b0,">",aR(bS,bZ)?bZ:bS)}else{if(!bP){bZ=ab(bO,bZ);bO.setCursor(bZ.line,bZ.ch)}}}if(bP){if(ca.lastSel){bS=bI;var bG=ca.lastSel;var b6=Math.abs(bG.head.line-bG.anchor.line);var b8=Math.abs(bG.head.ch-bG.anchor.ch);if(bG.visualLine){bZ=d(bI.line+b6,bI.ch)}else{if(bG.visualBlock){bZ=d(bI.line+b6,bI.ch+b8)}else{if(bG.head.line==bG.anchor.line){bZ=d(bI.line,bI.ch+b8)}else{bZ=d(bI.line+b6,bI.ch)}}}b0.visualMode=true;b0.visualLine=bG.visualLine;b0.visualBlock=bG.visualBlock;b1=b0.sel={anchor:bS,head:bZ};N(bO)}else{if(b0.visualMode){ca.lastSel={anchor:D(b1.anchor),head:D(b1.head),visualBlock:b0.visualBlock,visualLine:b0.visualLine}}}var bN,b2,bK,bW;var bL;if(b0.visualMode){bN=az(b1.head,b1.anchor);b2=be(b1.head,b1.anchor);bK=b0.visualLine||ca.linewise;bW=b0.visualBlock?"block":bK?"line":"char";bL=bF(bO,{anchor:bN,head:b2},bW);if(bK){var bH=bL.ranges;if(bW=="block"){for(var b3=0;b3<bH.length;b3++){bH[b3].head.ch=a0(bO,bH[b3].head.line)}}else{if(bW=="line"){bH[0].head=d(bH[0].head.line+1,0)}}}}else{bN=D(bS||bI);b2=D(bZ||bJ);if(aR(b2,bN)){var b7=bN;bN=b2;b2=b7}bK=bU.linewise||ca.linewise;if(bK){bi(bO,bN,b2)}else{if(bU.forward){ao(bO,bN,b2)}}bW="char";var b5=!bU.inclusive||bK;bL=bF(bO,{anchor:bN,head:b2},bW,b5)}bO.setSelections(bL.ranges,bL.primary);b0.lastMotion=null;ca.repeat=bQ;ca.registerName=bV;ca.linewise=bK;var b4=L[bP](bO,ca,bL.ranges,bI,bZ);if(b0.visualMode){aW(bO,b4!=null)}if(b4){bO.setCursor(b4)}}},recordLastEdit:function(bH,bG,bI){var bJ=s.macroModeState;if(bJ.isPlaying){return}bH.lastEditInputState=bG;bH.lastEditActionCommand=bI;bJ.lastInsertModeChanges.changes=[];bJ.lastInsertModeChanges.expectCursorActivityForChange=false}};var a6={moveToTopLine:function(bG,bI,bJ){var bH=bh(bG).top+bJ.repeat-1;return d(bH,a4(bG.getLine(bH)))},moveToMiddleLine:function(bG){var bI=bh(bG);var bH=Math.floor((bI.top+bI.bottom)*0.5);return d(bH,a4(bG.getLine(bH)))},moveToBottomLine:function(bG,bI,bJ){var bH=bh(bG).bottom-bJ.repeat+1;return d(bH,a4(bG.getLine(bH)))},expandToLine:function(bI,bH,bG){var bJ=bH;return d(bJ.line+bG.repeat-1,Infinity)},findNext:function(bG,bH,bI){var bL=aL(bG);var bK=bL.getQuery();if(!bK){return}var bJ=!bI.forward;bJ=(bL.isReversed())?!bJ:bJ;aN(bG,bK);return bE(bG,bJ,bK,bI.repeat)},goToMark:function(bG,bI,bJ,bH){var bL=bH.marks[bJ.selectedCharacter];if(bL){var bK=bL.find();return bJ.linewise?{line:bK.line,ch:a4(bG.getLine(bK.line))}:bK}return null},moveToOtherHighlightedEnd:function(bG,bI,bJ,bH){if(bH.visualBlock&&bJ.sameLine){var bK=bH.sel;return[ab(bG,d(bK.anchor.line,bK.head.ch)),ab(bG,d(bK.head.line,bK.anchor.ch))]}else{return([bH.sel.head,bH.sel.anchor])}},jumpToMark:function(bO,bN,bJ,bK){var bI=bN;for(var bL=0;bL<bJ.repeat;bL++){var bQ=bI;for(var bP in bK.marks){if(!F(bP)){continue}var bH=bK.marks[bP].find();var bG=(bJ.forward)?aR(bH,bQ):aR(bQ,bH);if(bG){continue}if(bJ.linewise&&(bH.line==bQ.line)){continue}var bM=bD(bQ,bI);var bR=(bJ.forward)?ay(bQ,bH,bI):ay(bI,bH,bQ);if(bM||bR){bI=bH}}}if(bJ.linewise){bI=d(bI.line,a4(bO.getLine(bI.line)))}return bI},moveByCharacters:function(bJ,bH,bG){var bL=bH;var bK=bG.repeat;var bI=bG.forward?bL.ch+bK:bL.ch-bK;return d(bL.line,bI)},moveByLines:function(bM,bL,bH,bI){var bO=bL;var bJ=bO.ch;switch(bI.lastMotion){case this.moveByLines:case this.moveByDisplayLines:case this.moveByScroll:case this.moveToColumn:case this.moveToEol:bJ=bI.lastHPos;break;default:bI.lastHPos=bJ}var bG=bH.repeat+(bH.repeatOffset||0);var bP=bH.forward?bO.line+bG:bO.line-bG;var bK=bM.firstLine();var bN=bM.lastLine();if(bP<bK&&bO.line==bK){return this.moveToStartOfLine(bM,bL,bH,bI)}else{if(bP>bN&&bO.line==bN){return this.moveToEol(bM,bL,bH,bI)}}if(bH.toFirstChar){bJ=a4(bM.getLine(bP));bI.lastHPos=bJ}bI.lastHSPos=bM.charCoords(d(bP,bJ),"div").left;return d(bP,bJ)},moveByDisplayLines:function(bO,bN,bI,bJ){var bP=bN;switch(bJ.lastMotion){case this.moveByDisplayLines:case this.moveByScroll:case this.moveByLines:case this.moveToColumn:case this.moveToEol:break;default:bJ.lastHSPos=bO.charCoords(bP,"div").left}var bG=bI.repeat;var bM=bO.findPosV(bP,(bI.forward?bG:-bG),"line",bJ.lastHSPos);if(bM.hitSide){if(bI.forward){var bH=bO.charCoords(bM,"div");var bK={top:bH.top+8,left:bJ.lastHSPos};var bM=bO.coordsChar(bK,"div")}else{var bL=bO.charCoords(d(bO.firstLine(),0),"div");bL.left=bJ.lastHSPos;bM=bO.coordsChar(bL,"div")}}bJ.lastHPos=bM.ch;return bM},moveByPage:function(bH,bJ,bI){var bG=bJ;var bK=bI.repeat;return bH.findPosV(bG,(bI.forward?bK:-bK),"page")},moveByParagraph:function(bG,bJ,bI){var bH=bI.forward?1:-1;return bs(bG,bJ,bI.repeat,bH)},moveByScroll:function(bM,bJ,bH,bI){var bN=bM.getScrollInfo();var bO=null;var bG=bH.repeat;if(!bG){bG=bN.clientHeight/(2*bM.defaultTextHeight())}var bL=bM.charCoords(bJ,"local");bH.repeat=bG;var bO=a6.moveByDisplayLines(bM,bJ,bH,bI);if(!bO){return null}var bK=bM.charCoords(bO,"local");bM.scrollTo(null,bN.top+bK.top-bL.top);return bO},moveByWords:function(bG,bI,bH){return aG(bG,bI,bH.repeat,!!bH.forward,!!bH.wordEnd,!!bH.bigWord)},moveTillCharacter:function(bH,bI,bJ){var bL=bJ.repeat;var bK=bw(bH,bL,bJ.forward,bJ.selectedCharacter);var bG=bJ.forward?-1:1;aH(bG,bJ);if(!bK){return null}bK.ch+=bG;return bK},moveToCharacter:function(bG,bI,bH){var bJ=bH.repeat;aH(0,bH);return bw(bG,bJ,bH.forward,bH.selectedCharacter)||bI},moveToSymbol:function(bG,bI,bH){var bJ=bH.repeat;return bx(bG,bJ,bH.forward,bH.selectedCharacter)||bI},moveToColumn:function(bG,bJ,bI,bH){var bK=bI.repeat;bH.lastHPos=bK-1;bH.lastHSPos=bG.charCoords(bJ,"div").left;return am(bG,bK)},moveToEol:function(bG,bL,bK,bJ){var bM=bL;bJ.lastHPos=Infinity;var bI=d(bM.line+bK.repeat-1,Infinity);var bH=bG.clipPos(bI);bH.ch--;bJ.lastHSPos=bG.charCoords(bH,"div").left;return bI},moveToFirstNonWhiteSpaceCharacter:function(bG,bH){var bI=bH;return d(bI.line,a4(bG.getLine(bI.line)))},moveToMatchedSymbol:function(bM,bK){var bN=bK;var bO=bN.line;var bG=bN.ch;var bL=bM.getLine(bO);var bJ;do{bJ=bL.charAt(bG++);if(bJ&&O(bJ)){var bH=bM.getTokenTypeAt(d(bO,bG));if(bH!=="string"&&bH!=="comment"){break}}}while(bJ);if(bJ){var bI=bM.findMatchingBracket(d(bO,bG));return bI.to}else{return bN}},moveToStartOfLine:function(bH,bG){return d(bG.line,0)},moveToLineOrEdgeOfDocument:function(bG,bH,bI){var bJ=bI.forward?bG.lastLine():bG.firstLine();if(bI.repeatIsExplicit){bJ=bI.repeat-bG.getOption("firstLineNumber")}return d(bJ,a4(bG.getLine(bJ)))},textObjectManipulation:function(bO,bM,bI,bJ){var bG={"(":")",")":"(","{":"}","}":"{","[":"]","]":"["};var bP={"'":true,'"':true};var bL=bI.selectedCharacter;if(bL=="b"){bL="("}else{if(bL=="B"){bL="{"}}var bN=!bI.textObjectInner;var bK;if(bG[bL]){bK=o(bO,bM,bL,bN)}else{if(bP[bL]){bK=aT(bO,bM,bL,bN)}else{if(bL==="W"){bK=aI(bO,bN,true,true)}else{if(bL==="w"){bK=aI(bO,bN,true,false)}else{if(bL==="p"){bK=bs(bO,bM,bI.repeat,0,bN);bI.linewise=true;if(bJ.visualMode){if(!bJ.visualLine){bJ.visualLine=true}}else{var bH=bJ.inputState.operatorArgs;if(bH){bH.linewise=true}bK.end.line--}}else{return null}}}}}if(!bO.state.vim.visualMode){return[bK.start,bK.end]}else{return v(bO,bK.start,bK.end)}},repeatLastCharacterSearch:function(bI,bL,bK){var bH=s.lastCharacterSearch;var bN=bK.repeat;var bJ=bK.forward===bH.forward;var bG=(bH.increment?1:0)*(bJ?-1:1);bI.moveH(-bG,"char");bK.inclusive=bJ?true:false;var bM=bw(bI,bN,bJ,bH.selectedCharacter);if(!bM){bI.moveH(bG,"char");return bL}bM.ch+=bG;return bM}};function au(bG,bH){a6[bG]=bH}function A(bJ,bI){var bG=[];for(var bH=0;bH<bI;bH++){bG.push(bJ)}return bG}var L={change:function(bQ,bO,bI){var bN,bR;var bK=bQ.state.vim;s.macroModeState.lastInsertModeChanges.inVisualBlock=bK.visualBlock;if(!bK.visualMode){var bL=bI[0].anchor,bP=bI[0].head;bR=bQ.getRange(bL,bP);var bG=bK.lastEditInputState||{};if(bG.motion=="moveByWords"&&!U(bR)){var bM=(/\s+$/).exec(bR);if(bM&&bG.motionArgs&&bG.motionArgs.forward){bP=E(bP,0,-bM[0].length);bR=bR.slice(0,-bM[0].length)}}var bS=new d(bL.line-1,Number.MAX_VALUE);var bH=bQ.firstLine()==bQ.lastLine();if(bP.line>bQ.lastLine()&&bO.linewise&&!bH){bQ.replaceRange("",bS,bP)}else{bQ.replaceRange("",bL,bP)}if(bO.linewise){if(!bH){bQ.setCursor(bS);b.commands.newlineAndIndent(bQ)}bL.ch=Number.MAX_VALUE}bN=bL}else{bR=bQ.getSelection();var bJ=A("",bI.length);bQ.replaceSelections(bJ);bN=az(bI[0].head,bI[0].anchor)}s.registerController.pushText(bO.registerName,"change",bR,bO.linewise,bI.length>1);r.enterInsertMode(bQ,{head:bN},bQ.state.vim)},"delete":function(bN,bL,bG){var bK,bO;var bI=bN.state.vim;if(!bI.visualBlock){var bJ=bG[0].anchor,bM=bG[0].head;if(bL.linewise&&bM.line!=bN.firstLine()&&bJ.line==bN.lastLine()&&bJ.line==bM.line-1){if(bJ.line==bN.firstLine()){bJ.ch=0}else{bJ=d(bJ.line-1,a0(bN,bJ.line-1))}}bO=bN.getRange(bJ,bM);bN.replaceRange("",bJ,bM);bK=bJ;if(bL.linewise){bK=a6.moveToFirstNonWhiteSpaceCharacter(bN,bJ)}}else{bO=bN.getSelection();var bH=A("",bG.length);bN.replaceSelections(bH);bK=bG[0].anchor}s.registerController.pushText(bL.registerName,"delete",bO,bL.linewise,bI.visualBlock);return ab(bN,bK)},indent:function(bN,bM,bG){var bK=bN.state.vim;var bO=bG[0].anchor.line;var bI=bK.visualBlock?bG[bG.length-1].anchor.line:bG[0].head.line;var bH=(bK.visualMode)?bM.repeat:1;if(bM.linewise){bI--}for(var bL=bO;bL<=bI;bL++){for(var bJ=0;bJ<bH;bJ++){bN.indentLine(bL,bM.indentRight)}}return a6.moveToFirstNonWhiteSpaceCharacter(bN,bG[0].anchor)},changeCase:function(bR,bQ,bG,bN,bK){var bH=bR.getSelections();var bI=[];var bJ=bQ.toLower;for(var bL=0;bL<bH.length;bL++){var bO=bH[bL];var bS="";if(bJ===true){bS=bO.toLowerCase()}else{if(bJ===false){bS=bO.toUpperCase()}else{for(var bM=0;bM<bO.length;bM++){var bP=bO.charAt(bM);bS+=C(bP)?bP.toLowerCase():bP.toUpperCase()}}}bI.push(bS)}bR.replaceSelections(bI);if(bQ.shouldMoveCursor){return bK}else{if(!bR.state.vim.visualMode&&bQ.linewise&&bG[0].anchor.line+1==bG[0].head.line){return a6.moveToFirstNonWhiteSpaceCharacter(bR,bN)}else{if(bQ.linewise){return bN}else{return az(bG[0].anchor,bG[0].head)}}}},yank:function(bG,bL,bH,bJ){var bI=bG.state.vim;var bM=bG.getSelection();var bK=bI.visualMode?az(bI.sel.anchor,bI.sel.head,bH[0].head,bH[0].anchor):bJ;s.registerController.pushText(bL.registerName,"yank",bM,bL.linewise,bI.visualBlock);return bK}};function bn(bG,bH){L[bG]=bH}var r={jumpListWalk:function(bG,bI,bJ){if(bJ.visualMode){return}var bL=bI.repeat;var bK=bI.forward;var bH=s.jumpList;var bN=bH.move(bG,bK?bL:-bL);var bM=bN?bN.find():undefined;bM=bM?bM:bG.getCursor();bG.setCursor(bM)},scroll:function(bO,bI,bK){if(bK.visualMode){return}var bG=bI.repeat||1;var bN=bO.defaultTextHeight();var bM=bO.getScrollInfo().top;var bP=bN*bG;var bL=bI.forward?bM+bP:bM-bP;var bQ=D(bO.getCursor());var bJ=bO.charCoords(bQ,"local");if(bI.forward){if(bL>bJ.top){bQ.line+=(bL-bJ.top)/bN;bQ.line=Math.ceil(bQ.line);bO.setCursor(bQ);bJ=bO.charCoords(bQ,"local");bO.scrollTo(null,bJ.top)}else{bO.scrollTo(null,bL)}}else{var bH=bL+bO.getScrollInfo().clientHeight;if(bH<bJ.bottom){bQ.line-=(bJ.bottom-bH)/bN;bQ.line=Math.floor(bQ.line);bO.setCursor(bQ);bJ=bO.charCoords(bQ,"local");bO.scrollTo(null,bJ.bottom-bO.getScrollInfo().clientHeight)}else{bO.scrollTo(null,bL)}}},scrollToCursor:function(bH,bI){var bL=bH.getCursor().line;var bJ=bH.charCoords(d(bL,0),"local");var bG=bH.getScrollInfo().clientHeight;var bM=bJ.top;var bK=bJ.bottom-bM;switch(bI.position){case"center":bM=bM-(bG/2)+bK;break;case"bottom":bM=bM-bG+bK;break}bH.scrollTo(null,bM)},replayMacro:function(bG,bH,bI){var bJ=bH.selectedCharacter;var bK=bH.repeat;var bL=s.macroModeState;if(bJ=="@"){bJ=bL.latestRegister}while(bK--){I(bG,bI,bL,bJ)}},enterMacroRecordMode:function(bG,bH){var bJ=s.macroModeState;var bI=bH.selectedCharacter;bJ.enterMacroRecordMode(bG,bI)},enterInsertMode:function(bH,bI,bJ){if(bH.getOption("readOnly")){return}bJ.insertMode=true;bJ.insertModeRepeat=bI&&bI.repeat||1;var bL=(bI)?bI.insertAt:null;var bM=bJ.sel;var bK=bI.head||bH.getCursor("head");var bG=bH.listSelections().length;if(bL=="eol"){bK=d(bK.line,a0(bH,bK.line))}else{if(bL=="charAfter"){bK=E(bK,0,1)}else{if(bL=="firstNonBlank"){bK=a6.moveToFirstNonWhiteSpaceCharacter(bH,bK)}else{if(bL=="startOfSelectedArea"){if(!bJ.visualBlock){if(bM.head.line<bM.anchor.line){bK=bM.head}else{bK=d(bM.anchor.line,0)}}else{bK=d(Math.min(bM.head.line,bM.anchor.line),Math.min(bM.head.ch,bM.anchor.ch));bG=Math.abs(bM.head.line-bM.anchor.line)+1}}else{if(bL=="endOfSelectedArea"){if(!bJ.visualBlock){if(bM.head.line>=bM.anchor.line){bK=E(bM.head,0,1)}else{bK=d(bM.anchor.line,0)}}else{bK=d(Math.min(bM.head.line,bM.anchor.line),Math.max(bM.head.ch+1,bM.anchor.ch));bG=Math.abs(bM.head.line-bM.anchor.line)+1}}else{if(bL=="inplace"){if(bJ.visualMode){return}}}}}}}bH.setOption("keyMap","vim-insert");bH.setOption("disableInput",false);if(bI&&bI.replace){bH.toggleOverwrite(true);bH.setOption("keyMap","vim-replace");b.signal(bH,"vim-mode-change",{mode:"replace"})}else{bH.setOption("keyMap","vim-insert");b.signal(bH,"vim-mode-change",{mode:"insert"})}if(!s.macroModeState.isPlaying){bH.on("change",bm);b.on(bH.getInputField(),"keydown",X)}if(bJ.visualMode){aW(bH)}aX(bH,bK,bG)},toggleVisualMode:function(bG,bH,bI){var bL=bH.repeat;var bJ=bG.getCursor();var bK;if(!bI.visualMode){bI.visualMode=true;bI.visualLine=!!bH.linewise;bI.visualBlock=!!bH.blockwise;bK=ab(bG,d(bJ.line,bJ.ch+bL-1),true);bI.sel={anchor:bJ,head:bK};b.signal(bG,"vim-mode-change",{mode:"visual",subMode:bI.visualLine?"linewise":bI.visualBlock?"blockwise":""});N(bG);aU(bG,bI,"<",az(bJ,bK));aU(bG,bI,">",be(bJ,bK))}else{if(bI.visualLine^bH.linewise||bI.visualBlock^bH.blockwise){bI.visualLine=!!bH.linewise;bI.visualBlock=!!bH.blockwise;b.signal(bG,"vim-mode-change",{mode:"visual",subMode:bI.visualLine?"linewise":bI.visualBlock?"blockwise":""});N(bG)}else{aW(bG)}}},reselectLastSelection:function(bG,bL,bI){var bH=bI.lastSelection;if(bI.visualMode){bl(bG,bI)}if(bH){var bJ=bH.anchorMark.find();var bK=bH.headMark.find();if(!bJ||!bK){return}bI.sel={anchor:bJ,head:bK};bI.visualMode=true;bI.visualLine=bH.visualLine;bI.visualBlock=bH.visualBlock;N(bG);aU(bG,bI,"<",az(bJ,bK));aU(bG,bI,">",be(bJ,bK));b.signal(bG,"vim-mode-change",{mode:"visual",subMode:bI.visualLine?"linewise":bI.visualBlock?"blockwise":""})}},joinLines:function(bN,bH,bJ){var bM,bP;if(bJ.visualMode){bM=bN.getCursor("anchor");bP=bN.getCursor("head");if(aR(bP,bM)){var bL=bP;bP=bM;bM=bL}bP.ch=a0(bN,bP.line)-1}else{var bG=Math.max(bH.repeat,2);bM=bN.getCursor();bP=ab(bN,d(bM.line+bG-1,Infinity))}var bI=0;for(var bK=bM.line;bK<bP.line;bK++){bI=a0(bN,bM.line);var bL=d(bM.line+1,a0(bN,bM.line+1));var bQ=bN.getRange(bM,bL);bQ=bQ.replace(/\n\s*/g," ");bN.replaceRange(bQ,bM,bL)}var bO=d(bM.line,bI);if(bJ.visualMode){aW(bN,false)}bN.setCursor(bO)},newLineAndEnterInsertMode:function(bG,bH,bI){bI.insertMode=true;var bJ=D(bG.getCursor());if(bJ.line===bG.firstLine()&&!bH.after){bG.replaceRange("\n",d(bG.firstLine(),0));bG.setCursor(bG.firstLine(),0)}else{bJ.line=(bH.after)?bJ.line:bJ.line-1;bJ.ch=a0(bG,bJ.line);bG.setCursor(bJ);var bK=b.commands.newlineAndIndentContinueComment||b.commands.newlineAndIndent;bK(bG)}this.enterInsertMode(bG,{repeat:bH.repeat},bI)},paste:function(bU,bT,b2){var bN=D(bU.getCursor());var bH=s.registerController.getRegister(bT.registerName);var bX=bH.toString();if(!bX){return}if(bT.matchIndent){var bZ=bU.getOption("tabSize");var bO=function(b9){var b8=(b9.split("\t").length-1);var b7=(b9.split(" ").length-1);return b8*bZ+b7*1};var b4=bU.getLine(bU.getCursor().line);var bW=bO(b4.match(/^\s*/)[0]);var bG=bX.replace(/\n$/,"");var bL=bX!==bG;var bR=bO(bX.match(/^\s*/)[0]);var bX=bG.replace(/^\s*/gm,function(b7){var b8=bW+(bO(b7)-bR);if(b8<0){return""}else{if(bU.getOption("indentWithTabs")){var b9=Math.floor(b8/bZ);return Array(b9+1).join("\t")}else{return Array(b8+1).join(" ")}}});bX+=bL?"\n":""}if(bT.repeat>1){var bX=Array(bT.repeat+1).join(bX)}var bQ=bH.linewise;var bS=bH.blockwise;if(bQ){if(b2.visualMode){bX=b2.visualLine?bX.slice(0,-1):"\n"+bX.slice(0,bX.length-1)+"\n"}else{if(bT.after){bX="\n"+bX.slice(0,bX.length-1);bN.ch=a0(bU,bN.line)}else{bN.ch=0}}}else{if(bS){bX=bX.split("\n");for(var b3=0;b3<bX.length;b3++){bX[b3]=(bX[b3]=="")?" ":bX[b3]}}bN.ch+=bT.after?1:0}var bK;var bY;if(b2.visualMode){b2.lastPastedText=bX;var bJ;var b6=bb(bU,b2);var b0=b6[0];var bI=b6[1];var b1=bU.getSelection();var bP=bU.listSelections();var bM=new Array(bP.length).join("1").split("1");if(b2.lastSelection){bJ=b2.lastSelection.headMark.find()}s.registerController.unnamedRegister.setText(b1);if(bS){bU.replaceSelections(bM);bI=d(b0.line+bX.length-1,b0.ch);bU.setCursor(b0);G(bU,bI);bU.replaceSelections(bX);bK=b0}else{if(b2.visualBlock){bU.replaceSelections(bM);bU.setCursor(b0);bU.replaceRange(bX,b0,b0);bK=b0}else{bU.replaceRange(bX,b0,bI);bK=bU.posFromIndex(bU.indexFromPos(b0)+bX.length-1)}}if(bJ){b2.lastSelection.headMark=bU.setBookmark(bJ)}if(bQ){bK.ch=0}}else{if(bS){bU.setCursor(bN);for(var b3=0;b3<bX.length;b3++){var bV=bN.line+b3;if(bV>bU.lastLine()){bU.replaceRange("\n",d(bV,0))}var b5=a0(bU,bV);if(b5<bN.ch){a1(bU,bV,bN.ch)}}bU.setCursor(bN);G(bU,d(bN.line+bX.length-1,bN.ch));bU.replaceSelections(bX);bK=bN}else{bU.replaceRange(bX,bN);if(bQ&&bT.after){bK=d(bN.line+1,a4(bU.getLine(bN.line+1)))}else{if(bQ&&!bT.after){bK=d(bN.line,a4(bU.getLine(bN.line)))}else{if(!bQ&&bT.after){bY=bU.indexFromPos(bN);bK=bU.posFromIndex(bY+bX.length-1)}else{bY=bU.indexFromPos(bN);bK=bU.posFromIndex(bY+bX.length)}}}}}if(b2.visualMode){aW(bU,false)}bU.setCursor(bK)},undo:function(bG,bH){bG.operation(function(){aA(bG,b.commands.undo,bH.repeat)();bG.setCursor(bG.getCursor("anchor"))})},redo:function(bG,bH){aA(bG,b.commands.redo,bH.repeat)()},setRegister:function(bI,bG,bH){bH.inputState.registerName=bG.selectedCharacter},setMark:function(bG,bH,bI){var bJ=bH.selectedCharacter;aU(bG,bI,bJ,bG.getCursor())},replace:function(bO,bI,bK){var bJ=bI.selectedCharacter;var bN=bO.getCursor();var bM;var bP;var bH=bO.listSelections();if(bK.visualMode){bN=bO.getCursor("start");bP=bO.getCursor("end")}else{var bQ=bO.getLine(bN.line);bM=bN.ch+bI.repeat;if(bM>bQ.length){bM=bQ.length}bP=d(bN.line,bM)}if(bJ=="\n"){if(!bK.visualMode){bO.replaceRange("",bN,bP)}(b.commands.newlineAndIndentContinueComment||b.commands.newlineAndIndent)(bO)}else{var bG=bO.getRange(bN,bP);bG=bG.replace(/[^\n]/g,bJ);if(bK.visualBlock){var bL=new Array(bO.getOption("tabSize")+1).join(" ");bG=bO.getSelection();bG=bG.replace(/\t/g,bL).replace(/[^\n]/g,bJ).split("\n");bO.replaceSelections(bG)}else{bO.replaceRange(bG,bN,bP)}if(bK.visualMode){bN=aR(bH[0].anchor,bH[0].head)?bH[0].anchor:bH[0].head;bO.setCursor(bN);aW(bO,false)}else{bO.setCursor(E(bP,0,-1))}}},incrementNumberToken:function(bQ,bH){var bR=bQ.getCursor();var bM=bQ.getLine(bR.line);var bT=/-?\d+/g;var bL;var bG;var bK;var bS;var bI;while((bL=bT.exec(bM))!==null){bI=bL[0];bG=bL.index;bK=bG+bI.length;if(bR.ch<bK){break}}if(!bH.backtrack&&(bK<=bR.ch)){return}if(bI){var bP=bH.increase?1:-1;var bJ=parseInt(bI)+(bP*bH.repeat);var bO=d(bR.line,bG);var bN=d(bR.line,bK);bS=bJ.toString();bQ.replaceRange(bS,bO,bN)}else{return}bQ.setCursor(d(bR.line,bG+bS.length-1))},repeatLastEdit:function(bH,bI,bJ){var bG=bJ.lastEditInputState;if(!bG){return}var bK=bI.repeat;if(bK&&bI.repeatIsExplicit){bJ.lastEditInputState.repeatOverride=bK}else{bK=bJ.lastEditInputState.repeatOverride||bK}z(bH,bJ,bK,false)},exitInsertMode:x};function bu(bG,bH){r[bG]=bH}function ab(bH,bL,bJ){var bI=Math.min(Math.max(bH.firstLine(),bL.line),bH.lastLine());var bG=a0(bH,bI)-1;bG=(bJ)?bG+1:bG;var bK=Math.min(Math.max(0,bL.ch),bG);return d(bI,bK)}function bo(bH){var bG={};for(var bI in bH){if(bH.hasOwnProperty(bI)){bG[bI]=bH[bI]}}return bG}function E(bH,bG,bI){if(typeof bG==="object"){bI=bG.ch;bG=bG.line}return d(bH.line+bG,bH.ch+bI)}function bj(bG,bH){return{line:bH.line-bG.line,ch:bH.line-bG.line}}function bq(bO,bM,bG,bK){var bJ,bN=[],bL=[];for(var bI=0;bI<bM.length;bI++){var bH=bM[bI];if(bG=="insert"&&bH.context!="insert"||bH.context&&bH.context!=bG||bK.operator&&bH.type=="action"||!(bJ=S(bO,bH.keys))){continue}if(bJ=="partial"){bN.push(bH)}if(bJ=="full"){bL.push(bH)}}return{partial:bN.length&&bN,full:bL.length&&bL}}function S(bJ,bG){if(bG.slice(-11)=="<character>"){var bH=bG.length-11;var bK=bJ.slice(0,bH);var bI=bG.slice(0,bH);return bK==bI&&bJ.length>bH?"full":bI.indexOf(bK)==0?"partial":false}else{return bJ==bG?"full":bG.indexOf(bJ)==0?"partial":false}}function R(bI){var bH=/^.*(<[\w\-]+>)$/.exec(bI);var bG=bH?bH[1]:bI.slice(-1);if(bG.length>1){switch(bG){case"<CR>":bG="\n";break;case"<Space>":bG=" ";break;default:break}}return bG}function aA(bG,bH,bI){return function(){for(var bJ=0;bJ<bI;bJ++){bH(bG)}}}function D(bG){return d(bG.line,bG.ch)}function bD(bH,bG){return bH.ch==bG.ch&&bH.line==bG.line}function aR(bH,bG){if(bH.line<bG.line){return true}if(bH.line==bG.line&&bH.ch<bG.ch){return true}return false}function az(bH,bG){if(arguments.length>2){bG=az.apply(undefined,Array.prototype.slice.call(arguments,1))}return aR(bH,bG)?bH:bG}function be(bH,bG){if(arguments.length>2){bG=be.apply(undefined,Array.prototype.slice.call(arguments,1))}return aR(bH,bG)?bG:bH}function ay(bJ,bI,bH){var bK=aR(bJ,bI);var bG=aR(bI,bH);return bK&&bG}function a0(bG,bH){return bG.getLine(bH).length}function bd(bG){if(bG.trim){return bG.trim()}return bG.replace(/^\s+|\s+$/g,"")}function i(bG){return bG.replace(/([.?*+$\[\]\/\\(){}|\-])/g,"\\$1")}function a1(bG,bK,bJ){var bI=a0(bG,bK);var bH=new Array(bJ-bI+1).join(" ");bG.setCursor(d(bK,bI));bG.replaceRange(bH,bG.getCursor())}function G(bO,bH){var bJ=[],bI=bO.listSelections();var bK=D(bO.clipPos(bH));var bZ=!bD(bH,bK);var bM=bO.getCursor("head");var bY=w(bI,bM);var bP=bD(bI[bY].head,bI[bY].anchor);var bX=bI.length-1;var bN=bX-bY>bY?bX:0;var bL=bI[bN].anchor;var bU=Math.min(bL.line,bK.line);var bG=Math.max(bL.line,bK.line);var bQ=bL.ch,bR=bK.ch;var bW=bI[bN].head.ch-bQ;var bT=bR-bQ;if(bW>0&&bT<=0){bQ++;if(!bZ){bR--}}else{if(bW<0&&bT>=0){bQ--;if(!bP){bR++}}else{if(bW<0&&bT==-1){bQ--;bR++}}}for(var bS=bU;bS<=bG;bS++){var bV={anchor:new d(bS,bQ),head:new d(bS,bR)};bJ.push(bV)}bY=bK.line==bG?bJ.length-1:0;bO.setSelections(bJ);bH.ch=bR;bL.ch=bQ;return bL}function aX(bH,bJ,bG){var bL=[];for(var bI=0;bI<bG;bI++){var bK=E(bJ,bI,0);bL.push({anchor:bK,head:bK})}bH.setSelections(bL,0)}function w(bH,bL,bG){for(var bI=0;bI<bH.length;bI++){var bJ=bG!="head"&&bD(bH[bI].anchor,bL);var bK=bG!="anchor"&&bD(bH[bI].head,bL);if(bJ||bK){return bI}}return -1}function bb(bH,bJ){var bI=bJ.lastSelection;var bG=function(){var bM=bH.listSelections();var bP=bM[0];var bL=bM[bM.length-1];var bN=aR(bP.anchor,bP.head)?bP.anchor:bP.head;var bO=aR(bL.anchor,bL.head)?bL.head:bL.anchor;return[bN,bO]};var bK=function(){var bV=bH.getCursor();var bW=bH.getCursor();var bQ=bI.visualBlock;if(bQ){var bN=bQ.width;var bX=bQ.height;bW=d(bV.line+bX,bV.ch+bN);var bO=[];for(var bR=bV.line;bR<bW.line;bR++){var bS=d(bR,bV.ch);var bU=d(bR,bW.ch);var bT={anchor:bS,head:bU};bO.push(bT)}bH.setSelections(bO)}else{var bM=bI.anchorMark.find();var bP=bI.headMark.find();var bY=bP.line-bM.line;var bL=bP.ch-bM.ch;bW={line:bW.line+bY,ch:bY?bW.ch:bL+bW.ch};if(bI.visualLine){bV=d(bV.line,0);bW=d(bW.line,a0(bH,bW.line))}bH.setSelection(bV,bW)}return[bV,bW]};if(!bJ.visualMode){return bK()}else{return bG()}}function bl(bG,bH){var bI=bH.sel.anchor;var bJ=bH.sel.head;if(bH.lastPastedText){bJ=bG.posFromIndex(bG.indexFromPos(bI)+bH.lastPastedText.length);bH.lastPastedText=null}bH.lastSelection={anchorMark:bG.setBookmark(bI),headMark:bG.setBookmark(bJ),anchor:D(bI),head:D(bJ),visualMode:bH.visualMode,visualLine:bH.visualLine,visualBlock:bH.visualBlock}}function v(bG,bM,bH){var bL=bG.state.vim.sel;var bK=bL.head;var bI=bL.anchor;var bJ;if(aR(bH,bM)){bJ=bH;bH=bM;bM=bJ}if(aR(bK,bI)){bK=az(bM,bK);bI=be(bI,bH)}else{bI=az(bM,bI);bK=be(bK,bH);bK=E(bK,0,-1);if(bK.ch==-1&&bK.line!=bG.firstLine()){bK=d(bK.line-1,a0(bG,bK.line-1))}}return[bI,bK]}function N(bG,bJ,bK){var bH=bG.state.vim;bJ=bJ||bH.sel;var bK=bK||bH.visualLine?"line":bH.visualBlock?"block":"char";var bI=bF(bG,bJ,bK);bG.setSelections(bI.ranges,bI.primary);ae(bG)}function bF(bU,bJ,bP,bI){var bR=D(bJ.head);var bO=D(bJ.anchor);if(bP=="char"){var bS=!bI&&!aR(bJ.head,bJ.anchor)?1:0;var bK=aR(bJ.head,bJ.anchor)?1:0;bR=E(bJ.head,0,bS);bO=E(bJ.anchor,0,bK);return{ranges:[{anchor:bO,head:bR}],primary:0}}else{if(bP=="line"){if(!aR(bJ.head,bJ.anchor)){bO.ch=0;var bT=bU.lastLine();if(bR.line>bT){bR.line=bT}bR.ch=a0(bU,bR.line)}else{bR.ch=0;bO.ch=a0(bU,bO.line)}return{ranges:[{anchor:bO,head:bR}],primary:0}}else{if(bP=="block"){var bQ=Math.min(bO.line,bR.line),bM=Math.min(bO.ch,bR.ch),bG=Math.max(bO.line,bR.line),bV=Math.max(bO.ch,bR.ch)+1;var bW=bG-bQ+1;var bL=bR.line==bQ?0:bW-1;var bH=[];for(var bN=0;bN<bW;bN++){bH.push({anchor:d(bQ+bN,bM),head:d(bQ+bN,bV)})}return{ranges:bH,primary:bL}}}}}function g(bG){var bH=bG.getCursor("head");if(bG.getSelection().length==1){bH=az(bH,bG.getCursor("anchor"))}return bH}function aW(bG,bI){var bH=bG.state.vim;if(bI!==false){bG.setCursor(ab(bG,bH.sel.head))}bl(bG,bH);bH.visualMode=false;bH.visualLine=false;bH.visualBlock=false;b.signal(bG,"vim-mode-change",{mode:"normal"});if(bH.fakeCursor){bH.fakeCursor.clear()}}function ao(bH,bG,bL){var bK=bH.getRange(bG,bL);if(/\n\s*$/.test(bK)){var bJ=bK.split("\n");bJ.pop();var bI;for(var bI=bJ.pop();bJ.length>0&&bI&&U(bI);bI=bJ.pop()){bL.line--;bL.ch=0}if(bI){bL.line--;bL.ch=a0(bH,bL.line)}else{bL.ch=0}}}function bi(bH,bG,bI){bG.ch=0;bI.ch=0;bI.line++}function a4(bH){if(!bH){return 0}var bG=bH.search(/\S/);return bG==-1?bH.length:bG}function aI(bM,bL,bI,bK,bR){var bO=g(bM);var bS=bM.getLine(bO.line);var bN=bO.ch;var bJ=bR?ar[0]:bA[0];while(!bJ(bS.charAt(bN))){bN++;if(bN>=bS.length){return null}}if(bK){bJ=bA[0]}else{bJ=ar[0];if(!bJ(bS.charAt(bN))){bJ=ar[1]}}var bH=bN,bG=bN;while(bJ(bS.charAt(bH))&&bH<bS.length){bH++}while(bJ(bS.charAt(bG))&&bG>=0){bG--}bG++;if(bL){var bP=bH;while(/\s/.test(bS.charAt(bH))&&bH<bS.length){bH++}if(bP==bH){var bQ=bG;while(/\s/.test(bS.charAt(bG-1))&&bG>0){bG--}if(!bG){bG=bQ}}}return{start:d(bO.line,bG),end:d(bO.line,bH)}}function bk(bG,bH,bI){if(!bD(bH,bI)){s.jumpList.add(bG,bH,bI)}}function aH(bG,bH){s.lastCharacterSearch.increment=bG;s.lastCharacterSearch.forward=bH.forward;s.lastCharacterSearch.selectedCharacter=bH.selectedCharacter}var T={"(":"bracket",")":"bracket","{":"bracket","}":"bracket","[":"section","]":"section","*":"comment","/":"comment",m:"method",M:"method","#":"preprocess"};var a2={bracket:{isComplete:function(bG){if(bG.nextCh===bG.symb){bG.depth++;if(bG.depth>=1){return true}}else{if(bG.nextCh===bG.reverseSymb){bG.depth--}}return false}},section:{init:function(bG){bG.curMoveThrough=true;bG.symb=(bG.forward?"]":"[")===bG.symb?"{":"}"},isComplete:function(bG){return bG.index===0&&bG.nextCh===bG.symb}},comment:{isComplete:function(bH){var bG=bH.lastCh==="*"&&bH.nextCh==="/";bH.lastCh=bH.nextCh;return bG}},method:{init:function(bG){bG.symb=(bG.symb==="m"?"{":"}");bG.reverseSymb=bG.symb==="{"?"}":"{"},isComplete:function(bG){if(bG.nextCh===bG.symb){return true}return false}},preprocess:{init:function(bG){bG.index=0},isComplete:function(bH){if(bH.nextCh==="#"){var bG=bH.lineText.match(/#(\w+)/)[1];if(bG==="endif"){if(bH.forward&&bH.depth===0){return true}bH.depth++}else{if(bG==="if"){if(!bH.forward&&bH.depth===0){return true}bH.depth--}}if(bG==="else"&&bH.depth===0){return true}}return false}}};function bx(bP,bH,bK,bI){var bS=D(bP.getCursor());var bQ=bK?1:-1;var bJ=bK?bP.lineCount():-1;var bO=bS.ch;var bU=bS.line;var bN=bP.getLine(bU);var bG={lineText:bN,nextCh:bN.charAt(bO),lastCh:null,index:bO,symb:bI,reverseSymb:(bK?{")":"(","}":"{"}:{"(":")","{":"}"})[bI],forward:bK,depth:0,curMoveThrough:false};var bL=T[bI];if(!bL){return bS}var bT=a2[bL].init;var bR=a2[bL].isComplete;if(bT){bT(bG)}while(bU!==bJ&&bH){bG.index+=bQ;bG.nextCh=bG.lineText.charAt(bG.index);if(!bG.nextCh){bU+=bQ;bG.lineText=bP.getLine(bU)||"";if(bQ>0){bG.index=0}else{var bM=bG.lineText.length;bG.index=(bM>0)?(bM-1):0}bG.nextCh=bG.lineText.charAt(bG.index)}if(bR(bG)){bS.line=bU;bS.ch=bG.index;bH--}}if(bG.nextCh||bG.curMoveThrough){return d(bU,bG.index)}return bS}function bz(bQ,bR,bJ,bO,bP){var bK=bR.line;var bN=bR.ch;var bU=bQ.getLine(bK);var bH=bJ?1:-1;var bL=bO?bA:ar;if(bP&&bU==""){bK+=bH;bU=bQ.getLine(bK);if(!h(bQ,bK)){return null}bN=(bJ)?0:bU.length}while(true){if(bP&&bU==""){return{from:0,to:0,line:bK}}var bM=(bH>0)?bU.length:-1;var bT=bM,bS=bM;while(bN!=bM){var bG=false;for(var bI=0;bI<bL.length&&!bG;++bI){if(bL[bI](bU.charAt(bN))){bT=bN;while(bN!=bM&&bL[bI](bU.charAt(bN))){bN+=bH}bS=bN;bG=bT!=bS;if(bT==bR.ch&&bK==bR.line&&bS==bT+bH){continue}else{return{from:Math.min(bT,bS+1),to:Math.max(bT,bS),line:bK}}}}if(!bG){bN+=bH}}bK+=bH;if(!h(bQ,bK)){return null}bU=bQ.getLine(bK);bN=(bH>0)?0:bU.length}}function aG(bQ,bS,bH,bL,bU,bO){var bM=D(bS);var bN=[];if(bL&&!bU||!bL&&bU){bH++}var bP=!(bL&&bU);for(var bJ=0;bJ<bH;bJ++){var bG=bz(bQ,bS,bL,bO,bP);if(!bG){var bI=a0(bQ,bQ.lastLine());bN.push(bL?{line:bQ.lastLine(),from:bI,to:bI}:{line:0,from:0,to:0});break}bN.push(bG);bS=d(bG.line,bL?(bG.to-1):bG.from)}var bK=bN.length!=bH;var bR=bN[0];var bT=bN.pop();if(bL&&!bU){if(!bK&&(bR.from!=bM.ch||bR.line!=bM.line)){bT=bN.pop()}return d(bT.line,bT.from)}else{if(bL&&bU){return d(bT.line,bT.to-1)}else{if(!bL&&bU){if(!bK&&(bR.to!=bM.ch||bR.line!=bM.line)){bT=bN.pop()}return d(bT.line,bT.to)}else{return d(bT.line,bT.from)}}}}function bw(bL,bH,bJ,bK){var bN=bL.getCursor();var bG=bN.ch;var bM;for(var bI=0;bI<bH;bI++){var bO=bL.getLine(bN.line);bM=bf(bG,bO,bK,bJ,true);if(bM==-1){return null}bG=bM}return d(bL.getCursor().line,bM)}function am(bG,bI){var bH=bG.getCursor().line;return ab(bG,d(bH,bI-1))}function aU(bG,bH,bI,bJ){if(!K(bI,aJ)){return}if(bH.marks[bI]){bH.marks[bI].clear()}bH.marks[bI]=bG.setBookmark(bJ)}function bf(bL,bH,bK,bI,bJ){var bG;if(bI){bG=bH.indexOf(bK,bL+1);if(bG!=-1&&!bJ){bG-=1}}else{bG=bH.lastIndexOf(bK,bL-1);if(bG!=-1&&!bJ){bG+=1}}return bG}function bs(bU,bR,bH,bI,bT){var bV=bR.line;var bM=bU.firstLine();var bS=bU.lastLine();var bG,bJ,bP=bV;function bO(bW){return !bU.getLine(bW)}function bQ(bX,bW,bY){if(bY){return bO(bX)!=bO(bX+bW)}return !bO(bX)&&bO(bX+bW)}if(bI){while(bM<=bP&&bP<=bS&&bH>0){if(bQ(bP,bI)){bH--}bP+=bI}return new d(bP,0)}var bL=bU.state.vim;if(bL.visualLine&&bQ(bV,1,true)){var bN=bL.sel.anchor;if(bQ(bN.line,-1,true)){if(!bT||bN.line!=bV){bV+=1}}}var bK=bO(bV);for(bP=bV;bP<=bS&&bH;bP++){if(bQ(bP,1,true)){if(!bT||bO(bP)!=bK){bH--}}}bJ=new d(bP,0);if(bP>bS&&!bK){bK=true}else{bT=false}for(bP=bV;bP>bM;bP--){if(!bT||bO(bP)==bK||bP==bV){if(bQ(bP,-1,true)){break}}}bG=new d(bP,0);return{start:bG,end:bJ}}function o(bQ,bO,bI,bP){var bR=bO,bH,bK;var bN=({"(":/[()]/,")":/[()]/,"[":/[[\]]/,"]":/[[\]]/,"{":/[{}]/,"}":/[{}]/})[bI];var bJ=({"(":"(",")":"(","[":"[","]":"[","{":"{","}":"{"})[bI];var bG=bQ.getLine(bR.line).charAt(bR.ch);var bL=bG===bJ?1:0;bH=bQ.scanForBracket(d(bR.line,bR.ch+bL),-1,null,{bracketRegex:bN});bK=bQ.scanForBracket(d(bR.line,bR.ch+bL),1,null,{bracketRegex:bN});if(!bH||!bK){return{start:bR,end:bR}}bH=bH.pos;bK=bK.pos;if((bH.line==bK.line&&bH.ch>bK.ch)||(bH.line>bK.line)){var bM=bH;bH=bK;bK=bM}if(bP){bK.ch+=1}else{bH.ch+=1}return{start:bH,end:bK}}function aT(bP,bN,bI,bO){var bQ=D(bN);var bR=bP.getLine(bQ.line);var bM=bR.split("");var bH,bJ,bK,bL;var bG=bM.indexOf(bI);if(bQ.ch<bG){bQ.ch=bG}else{if(bG<bQ.ch&&bM[bQ.ch]==bI){bJ=bQ.ch;--bQ.ch}}if(bM[bQ.ch]==bI&&!bJ){bH=bQ.ch+1}else{for(bK=bQ.ch;bK>-1&&!bH;bK--){if(bM[bK]==bI){bH=bK+1}}}if(bH&&!bJ){for(bK=bH,bL=bM.length;bK<bL&&!bJ;bK++){if(bM[bK]==bI){bJ=bK}}}if(!bH||!bJ){return{start:bQ,end:bQ}}if(bO){--bH;++bJ}return{start:d(bQ.line,bH),end:d(bQ.line,bJ)}}aO("pcre",true,"boolean");function af(){}af.prototype={getQuery:function(){return s.query},setQuery:function(bG){s.query=bG},getOverlay:function(){return this.searchOverlay},setOverlay:function(bG){this.searchOverlay=bG},isReversed:function(){return s.isReversed},setReversed:function(bG){s.isReversed=bG},getScrollbarAnnotate:function(){return this.annotate},setScrollbarAnnotate:function(bG){this.annotate=bG}};function aL(bG){var bH=bG.state.vim;return bH.searchState_||(bH.searchState_=new af())}function ad(bG,bJ,bK,bH,bI){if(bG.openDialog){bG.openDialog(bJ,bH,{bottom:true,value:bI.value,onKeyDown:bI.onKeyDown,onKeyUp:bI.onKeyUp,selectValueOnOpen:false})}else{bH(prompt(bK,""))}}function y(bI){var bH=an(bI)||[];if(!bH.length){return[]}var bJ=[];if(bH[0]!==0){return}for(var bG=0;bG<bH.length;bG++){if(typeof bH[bG]=="number"){bJ.push(bI.substring(bH[bG]+1,bH[bG+1]))}}return bJ}function an(bJ){var bH=false;var bI=[];for(var bG=0;bG<bJ.length;bG++){var bK=bJ.charAt(bG);if(!bH&&bK=="/"){bI.push(bG)}bH=!bH&&(bK=="\\")}return bI}function bv(bN){var bO="|(){";var bK="}";var bL=false;var bH=[];for(var bI=-1;bI<bN.length;bI++){var bM=bN.charAt(bI)||"";var bG=bN.charAt(bI+1)||"";var bJ=(bG&&bO.indexOf(bG)!=-1);if(bL){if(bM!=="\\"||!bJ){bH.push(bM)}bL=false}else{if(bM==="\\"){bL=true;if(bG&&bK.indexOf(bG)!=-1){bJ=true}if(!bJ||bG==="\\"){bH.push(bM)}}else{bH.push(bM);if(bJ&&bG!=="\\"){bH.push("\\")}}}}return bH.join("")}var ba={"\\n":"\n","\\r":"\r","\\t":"\t"};function by(bJ){var bI=false;var bG=[];for(var bH=-1;bH<bJ.length;bH++){var bL=bJ.charAt(bH)||"";var bK=bJ.charAt(bH+1)||"";if(ba[bL+bK]){bG.push(ba[bL+bK]);bH++}else{if(bI){bG.push(bL);bI=false}else{if(bL==="\\"){bI=true;if((aj(bK)||bK==="$")){bG.push("$")}else{if(bK!=="/"&&bK!=="\\"){bG.push("\\")}}}else{if(bL==="$"){bG.push("$")}bG.push(bL);if(bK==="/"){bG.push("\\")}}}}}return bG.join("")}var ag={"\\/":"/","\\\\":"\\","\\n":"\n","\\r":"\r","\\t":"\t"};function ai(bK){var bJ=new b.StringStream(bK);var bH=[];while(!bJ.eol()){while(bJ.peek()&&bJ.peek()!="\\"){bH.push(bJ.next())}var bG=false;for(var bI in ag){if(bJ.match(bI,true)){bG=true;bH.push(ag[bI]);break}}if(!bG){bH.push(bJ.next())}}return bH.join("")}function aD(bK,bI,bN){var bM=s.registerController.getRegister("/");bM.setText(bK);if(bK instanceof RegExp){return bK}var bL=an(bK);var bO;var bH;if(!bL.length){bO=bK}else{bO=bK.substring(0,bL[0]);var bG=bK.substring(bL[0]);bH=(bG.indexOf("i")!=-1)}if(!bO){return null}if(!p("pcre")){bO=bv(bO)}if(bN){bI=(/^[^A-Z]*$/).test(bO)}var bJ=new RegExp(bO,(bI||bH)?"i":undefined);return bJ}function br(bG,bH){if(bG.openNotification){bG.openNotification('<span style="color: red">'+bH+"</span>",{bottom:true,duration:5000})}else{alert(bH)}}function aK(bH,bI){var bG='<span style="font-family: monospace; white-space: pre">'+(bH||"")+'<input type="text"></span>';if(bI){bG+=' <span style="color: #888">'+bI+"</span>"}return bG}var Q="(Javascript regexp)";function a5(bH,bI){var bJ=(bI.prefix||"")+" "+(bI.desc||"");var bG=aK(bI.prefix,bI.desc);ad(bH,bG,bJ,bI.onClose,bI)}function Z(bH,bG){if(bH instanceof RegExp&&bG instanceof RegExp){var bJ=["global","multiline","ignoreCase","source"];for(var bI=0;bI<bJ.length;bI++){var bK=bJ[bI];if(bH[bK]!==bG[bK]){return false}}return true}return false}function bC(bG,bL,bH,bI){if(!bL){return}var bK=aL(bG);var bJ=aD(bL,!!bH,!!bI);if(!bJ){return}aN(bG,bJ);if(Z(bJ,bK.getQuery())){return bJ}bK.setQuery(bJ);return bJ}function aQ(bH){if(bH.source.charAt(0)=="^"){var bG=true}return{token:function(bJ){if(bG&&!bJ.sol()){bJ.skipToEnd();return}var bI=bJ.match(bH,false);if(bI){if(bI[0].length==0){bJ.next();return"searching"}if(!bJ.sol()){bJ.backUp(1);if(!bH.exec(bJ.next()+bI[0])){bJ.next();return null}}bJ.match(bH);return"searching"}while(!bJ.eol()){bJ.next();if(bJ.match(bH,false)){break}}},query:bH}}function aN(bG,bJ){var bI=aL(bG);var bH=bI.getOverlay();if(!bH||bJ!=bH.query){if(bH){bG.removeOverlay(bH)}bH=aQ(bJ);bG.addOverlay(bH);if(bG.showMatchesOnScrollbar){if(bI.getScrollbarAnnotate()){bI.getScrollbarAnnotate().clear()}bI.setScrollbarAnnotate(bG.showMatchesOnScrollbar(bJ))}bI.setOverlay(bH)}}function bE(bG,bH,bJ,bI){if(bI===undefined){bI=1}return bG.operation(function(){var bN=bG.getCursor();var bM=bG.getSearchCursor(bJ,bN);for(var bK=0;bK<bI;bK++){var bL=bM.find(bH);if(bK==0&&bL&&bD(bM.from(),bN)){bL=bM.find(bH)}if(!bL){bM=bG.getSearchCursor(bJ,(bH)?d(bG.lastLine()):d(bG.firstLine(),0));if(!bM.find(bH)){return}}}return bM.from()})}function aP(bG){var bH=aL(bG);bG.removeOverlay(aL(bG).getOverlay());bH.setOverlay(null);if(bH.getScrollbarAnnotate()){bH.getScrollbarAnnotate().clear();bH.setScrollbarAnnotate(null)}}function ah(bI,bH,bG){if(typeof bI!="number"){bI=bI.line}if(bH instanceof Array){return K(bI,bH)}else{if(bG){return(bI>=bH&&bI<=bG)}else{return bI==bH}}}function bh(bG){var bJ=bG.getScrollInfo();var bI=6;var bM=10;var bL=bG.coordsChar({left:0,top:bI+bJ.top},"local");var bH=bJ.clientHeight-bM+bJ.top;var bK=bG.coordsChar({left:0,top:bH},"local");return{top:bL.line,bottom:bK.line}}var aa=function(){this.buildCommandMap_()};aa.prototype={processCommand:function(bG,bH,bJ){var bI=this;bG.operation(function(){bG.curOp.isVimOp=true;bI._processCommand(bG,bH,bJ)})},_processCommand:function(bR,bQ,bH){var bL=bR.state.vim;var bI=s.registerController.getRegister(":");var bO=bI.toString();if(bL.visualMode){aW(bR)}var bG=new b.StringStream(bQ);bI.setText(bQ);var bK=bH||{};bK.input=bQ;try{this.parseInput_(bR,bG,bK)}catch(bP){br(bR,bP);throw bP}var bJ;var bN;if(!bK.commandName){if(bK.line!==undefined){bN="move"}}else{bJ=this.matchCommand_(bK.commandName);if(bJ){bN=bJ.name;if(bJ.excludeFromCommandHistory){bI.setText(bO)}this.parseCommandArgs_(bG,bK,bJ);if(bJ.type=="exToKey"){for(var bM=0;bM<bJ.toKeys.length;bM++){b.Vim.handleKey(bR,bJ.toKeys[bM],"mapping")}return}else{if(bJ.type=="exToEx"){this.processCommand(bR,bJ.toInput);return}}}}if(!bN){br(bR,'Not an editor command ":'+bQ+'"');return}try{a9[bN](bR,bK);if((!bJ||!bJ.possiblyAsync)&&bK.callback){bK.callback()}}catch(bP){br(bR,bP);throw bP}},parseInput_:function(bH,bI,bG){bI.eatWhile(":");if(bI.eat("%")){bG.line=bH.firstLine();bG.lineEnd=bH.lastLine()}else{bG.line=this.parseLineSpec_(bH,bI);if(bG.line!==undefined&&bI.eat(",")){bG.lineEnd=this.parseLineSpec_(bH,bI)}}var bJ=bI.match(/^(\w+)/);if(bJ){bG.commandName=bJ[1]}else{bG.commandName=bI.match(/.*/)[0]}return bG},parseLineSpec_:function(bG,bH){var bI=bH.match(/^(\d+)/);if(bI){return parseInt(bI[1],10)-1}switch(bH.next()){case".":return bG.getCursor().line;case"$":return bG.lastLine();case"'":var bJ=bG.state.vim.marks[bH.next()];if(bJ&&bJ.find()){return bJ.find().line}throw new Error("Mark not set");default:bH.backUp(1);return undefined}},parseCommandArgs_:function(bH,bK,bJ){if(bH.eol()){return}bK.argString=bH.match(/.*/)[0];var bI=bJ.argDelimiter||/\s+/;var bG=bd(bK.argString).split(bI);if(bG.length&&bG[0]){bK.args=bG}},matchCommand_:function(bH){for(var bG=bH.length;bG>0;bG--){var bI=bH.substring(0,bG);if(this.commandMap_[bI]){var bJ=this.commandMap_[bI];if(bJ.name.indexOf(bH)===0){return bJ}}}return null},buildCommandMap_:function(){this.commandMap_={};for(var bH=0;bH<e.length;bH++){var bI=e[bH];var bG=bI.shortName||bI.name;this.commandMap_[bG]=bI}},map:function(bH,bK,bG){if(bH!=":"&&bH.charAt(0)==":"){if(bG){throw Error("Mode not supported for ex mappings")}var bJ=bH.substring(1);if(bK!=":"&&bK.charAt(0)==":"){this.commandMap_[bJ]={name:bJ,type:"exToEx",toInput:bK.substring(1),user:true}}else{this.commandMap_[bJ]={name:bJ,type:"exToKey",toKeys:bK,user:true}}}else{if(bK!=":"&&bK.charAt(0)==":"){var bI={keys:bH,type:"keyToEx",exArgs:{input:bK.substring(1)},user:true};if(bG){bI.context=bG}a.unshift(bI)}else{var bI={keys:bH,type:"keyToKey",toKeys:bK,user:true};if(bG){bI.context=bG}a.unshift(bI)}}},unmap:function(bH,bG){if(bH!=":"&&bH.charAt(0)==":"){if(bG){throw Error("Mode not supported for ex mappings")}var bJ=bH.substring(1);if(this.commandMap_[bJ]&&this.commandMap_[bJ].user){delete this.commandMap_[bJ];return}}else{var bK=bH;for(var bI=0;bI<a.length;bI++){if(bK==a[bI].keys&&a[bI].context===bG&&a[bI].user){a.splice(bI,1);return}}}throw Error("No such mapping.")}};var a9={colorscheme:function(bG,bH){if(!bH.args||bH.args.length<1){br(bG,bG.getOption("theme"));return}bG.setOption("theme",bH.args[0])},map:function(bG,bJ,bH){var bI=bJ.args;if(!bI||bI.length<2){if(bG){br(bG,"Invalid mapping: "+bJ.input)}return}n.map(bI[0],bI[1],bH)},imap:function(bG,bH){this.map(bG,bH,"insert")},nmap:function(bG,bH){this.map(bG,bH,"normal")},vmap:function(bG,bH){this.map(bG,bH,"visual")},unmap:function(bG,bJ,bH){var bI=bJ.args;if(!bI||bI.length<1){if(bG){br(bG,"No such mapping: "+bJ.input)}return}n.unmap(bI[0],bH)},move:function(bG,bH){bg.processCommand(bG,bG.state.vim,{type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:false,explicitRepeat:true,linewise:true},repeatOverride:bH.line+1})},set:function(bP,bL){var bJ=bL.args;var bM=bL.setCfg||{};if(!bJ||bJ.length<1){if(bP){br(bP,"Invalid mapping: "+bL.input)}return}var bN=bJ[0].split("=");var bH=bN[0];var bO=bN[1];var bK=false;if(bH.charAt(bH.length-1)=="?"){if(bO){throw Error("Trailing characters: "+bL.argString)}bH=bH.substring(0,bH.length-1);bK=true}if(bO===undefined&&bH.substring(0,2)=="no"){bH=bH.substring(2);bO=false}var bI=ax[bH]&&ax[bH].type=="boolean";if(bI&&bO==undefined){bO=true}if(!bI&&bO===undefined||bK){var bG=p(bH,bP,bM);if(bG===true||bG===false){br(bP," "+(bG?"":"no")+bH)}else{br(bP,"  "+bH+"="+bG)}}else{aM(bH,bO,bP,bM)}},setlocal:function(bG,bH){bH.setCfg={scope:"local"};this.set(bG,bH)},setglobal:function(bG,bH){bH.setCfg={scope:"global"};this.set(bG,bH)},registers:function(bL,bH){var bN=bH.args;var bK=s.registerController.registers;var bI="----------Registers----------<br><br>";if(!bN){for(var bG in bK){var bO=bK[bG].toString();if(bO.length){bI+='"'+bG+"    "+bO+"<br>"}}}else{var bG;bN=bN.join("");for(var bJ=0;bJ<bN.length;bJ++){bG=bN.charAt(bJ);if(!s.registerController.isValidRegister(bG)){continue}var bM=bK[bG]||new bt();bI+='"'+bG+"    "+bM.toString()+"<br>"}}br(bL,bI)},sort:function(bP,bZ){var bQ,bJ,bH,bI;function bK(){if(bZ.argString){var b3=new b.StringStream(bZ.argString);if(b3.eat("!")){bQ=true}if(b3.eol()){return}if(!b3.eatSpace()){return"Invalid arguments"}var b5=b3.match(/[a-z]+/);if(b5){b5=b5[0];bJ=b5.indexOf("i")!=-1;bH=b5.indexOf("u")!=-1;var b2=b5.indexOf("d")!=-1&&1;var b4=b5.indexOf("x")!=-1&&1;var b1=b5.indexOf("o")!=-1&&1;if(b2+b4+b1>1){return"Invalid arguments"}bI=b2&&"decimal"||b4&&"hex"||b1&&"octal"}if(b3.match(/\/.*\//)){return"patterns not supported"}}}var bL=bK();if(bL){br(bP,bL+": "+bZ.argString);return}var bU=bZ.line||bP.firstLine();var bY=bZ.lineEnd||bZ.line||bP.lastLine();if(bU==bY){return}var bO=d(bU,0);var bW=d(bY,a0(bP,bY));var bT=bP.getRange(bO,bW).split("\n");var bM=(bI=="decimal")?/(-?)([\d]+)/:(bI=="hex")?/(-?)(?:0x)?([0-9a-f]+)/i:(bI=="octal")?/([0-7]+)/:null;var bN=(bI=="decimal")?10:(bI=="hex")?16:(bI=="octal")?8:null;var bR=[],bV=[];if(bI){for(var bX=0;bX<bT.length;bX++){if(bM.exec(bT[bX])){bR.push(bT[bX])}else{bV.push(bT[bX])}}}else{bV=bT}function b0(b2,b1){if(bQ){var b3;b3=b2;b2=b1;b1=b3}if(bJ){b2=b2.toLowerCase();b1=b1.toLowerCase()}var b5=bI&&bM.exec(b2);var b4=bI&&bM.exec(b1);if(!b5){return b2<b1?-1:1}b5=parseInt((b5[1]+b5[2]).toLowerCase(),bN);b4=parseInt((b4[1]+b4[2]).toLowerCase(),bN);return b5-b4}bR.sort(b0);bV.sort(b0);bT=(!bQ)?bV.concat(bR):bR.concat(bV);if(bH){var bS=bT;var bG;bT=[];for(var bX=0;bX<bS.length;bX++){if(bS[bX]!=bG){bT.push(bS[bX])}bG=bS[bX]}}bP.replaceRange(bT.join("\n"),bO,bW)},global:function(bT,bK){var bH=bK.argString;if(!bH){br(bT,"Regular Expression missing from global");return}var bN=(bK.line!==undefined)?bK.line:bT.firstLine();var bL=bK.lineEnd||bK.line||bT.lastLine();var bS=y(bH);var bV=bH,bJ;if(bS.length){bV=bS[0];bJ=bS.slice(1,bS.length).join("/")}if(bV){try{bC(bT,bV,true,true)}catch(bQ){br(bT,"Invalid regex: "+bV);return}}var bR=aL(bT).getQuery();var bG=[],bP="";for(var bM=bN;bM<=bL;bM++){var bI=bR.test(bT.getLine(bM));if(bI){bG.push(bM+1);bP+=bT.getLine(bM)+"<br>"}}if(!bJ){br(bT,bP);return}var bO=0;var bU=function(){if(bO<bG.length){var bW=bG[bO]+bJ;n.processCommand(bT,bW,{callback:bU})}bO++};bU()},substitute:function(bN,bV){if(!bN.getSearchCursor){throw new Error("Search feature not available. Requires searchcursor.js or any other getSearchCursor implementation.")}var bW=bV.argString;var bQ=bW?y(bW):[];var bO,bP="",bG,bH,bL;var bM=false;var bS=false;if(bQ.length){bO=bQ[0];bP=bQ[1];if(bP!==undefined){if(p("pcre")){bP=ai(bP)}else{bP=by(bP)}s.lastSubstituteReplacePart=bP}bG=bQ[2]?bQ[2].split(" "):[]}else{if(bW&&bW.length){br(bN,"Substitutions should be of the form :s/pattern/replace/");return}}if(bG){bH=bG[0];bL=parseInt(bG[1]);if(bH){if(bH.indexOf("c")!=-1){bM=true;bH.replace("c","")}if(bH.indexOf("g")!=-1){bS=true;bH.replace("g","")}bO=bO+"/"+bH}}if(bO){try{bC(bN,bO,true,true)}catch(bU){br(bN,"Invalid regex: "+bO);return}}bP=bP||s.lastSubstituteReplacePart;if(bP===undefined){br(bN,"No previous substitute regular expression");return}var bJ=aL(bN);var bK=bJ.getQuery();var bR=(bV.line!==undefined)?bV.line:bN.getCursor().line;var bT=bV.lineEnd||bR;if(bR==bN.firstLine()&&bT==bN.lastLine()){bT=Infinity}if(bL){bR=bT;bT=bR+bL-1}var bX=ab(bN,d(bR,0));var bI=bN.getSearchCursor(bK,bX);bc(bN,bM,bS,bR,bT,bI,bK,bP,bV.callback)},redo:b.commands.redo,undo:b.commands.undo,write:function(bG){if(b.commands.save){b.commands.save(bG)}else{if(bG.save){bG.save()}}if(document.getElementById("sys_script_fix.script.save")!==null){document.getElementById("sys_script_fix.script.save").click()}if(c){c.save()}},nohlsearch:function(bG){aP(bG)},yank:function(bG){var bJ=D(bG.getCursor());var bI=bJ.line;var bH=bG.getLine(bI);s.registerController.pushText("0","yank",bH,true,true)},delmarks:function(bQ,bL){if(!bL.argString||!bd(bL.argString)){br(bQ,"Argument required");return}var bG=bQ.state.vim;var bR=new b.StringStream(bd(bL.argString));while(!bR.eol()){bR.eatSpace();var bO=bR.pos;if(!bR.match(/[a-zA-Z]/,false)){br(bQ,"Invalid argument: "+bL.argString.substring(bO));return}var bI=bR.next();if(bR.match("-",true)){if(!bR.match(/[a-zA-Z]/,false)){br(bQ,"Invalid argument: "+bL.argString.substring(bO));return}var bJ=bI;var bN=bR.next();if(F(bJ)&&F(bN)||C(bJ)&&C(bN)){var bH=bJ.charCodeAt(0);var bP=bN.charCodeAt(0);if(bH>=bP){br(bQ,"Invalid argument: "+bL.argString.substring(bO));return}for(var bM=0;bM<=bP-bH;bM++){var bK=String.fromCharCode(bH+bM);delete bG.marks[bK]}}else{br(bQ,"Invalid argument: "+bJ+"-");return}}else{delete bG.marks[bI]}}}};var n=new aa();function bc(bU,bH,bJ,bP,bN,bI,bR,bL,bV){bU.state.vim.exMode=true;var bM=false;var bT=bI.from();function bQ(){bU.operation(function(){while(!bM){bK();bO()}bS()})}function bK(){var bX=bU.getRange(bI.from(),bI.to());var bW=bX.replace(bR,bL);bI.replace(bW)}function bO(){while(bI.findNext()&&ah(bI.from(),bP,bN)){if(!bJ&&bT&&bI.from().line==bT.line){continue}bU.scrollIntoView(bI.from(),30);bU.setSelection(bI.from(),bI.to());bT=bI.from();bM=false;return}bM=true}function bS(bX){if(bX){bX()}bU.focus();if(bT){bU.setCursor(bT);var bW=bU.state.vim;bW.exMode=false;bW.lastHPos=bW.lastHSPos=bT.ch}if(bV){bV()}}function bG(bZ,bW,b0){b.e_stop(bZ);var bX=b.keyName(bZ);switch(bX){case"Y":bK();bO();break;case"N":bO();break;case"A":var bY=bV;bV=undefined;bU.operation(bQ);bV=bY;break;case"L":bK();case"Q":case"Esc":case"Ctrl-C":case"Ctrl-[":bS(b0);break}if(bM){bS(b0)}return true}bO();if(bM){br(bU,"No matches for "+bR.source);return}if(!bH){bQ();if(bV){bV()}return}a5(bU,{prefix:"replace with <strong>"+bL+"</strong> (y/n/a/q/l)",onKeyDown:bG})}b.keyMap.vim={attach:u,detach:j,call:a7};function x(bO){var bH=bO.state.vim;var bJ=s.macroModeState;var bM=s.registerController.getRegister(".");var bG=bJ.isPlaying;var bK=bJ.lastInsertModeChanges;var bP=[];if(!bG){var bL=bK.inVisualBlock?bH.lastSelection.visualBlock.height:1;var bN=bK.changes;var bP=[];var bI=0;while(bI<bN.length){bP.push(bN[bI]);if(bN[bI] instanceof bp){bI++}else{bI+=bL}}bK.changes=bP;bO.off("change",bm);b.off(bO.getInputField(),"keydown",X)}if(!bG&&bH.insertModeRepeat>1){z(bO,bH,bH.insertModeRepeat-1,true);bH.lastEditInputState.repeatOverride=bH.insertModeRepeat}delete bH.insertModeRepeat;bH.insertMode=false;bO.setCursor(bO.getCursor().line,bO.getCursor().ch-1);bO.setOption("keyMap","vim");bO.setOption("disableInput",true);bO.toggleOverwrite(false);bM.setText(bK.changes.join(""));b.signal(bO,"vim-mode-change",{mode:"normal"});if(bJ.isRecording){aq(bJ)}}function q(bG){a.unshift(bG)}function aC(bL,bK,bI,bH,bG){var bM={keys:bL,type:bK};bM[bK]=bI;bM[bK+"Args"]=bH;for(var bJ in bG){bM[bJ]=bG[bJ]}q(bM)}aO("insertModeEscKeysTimeout",200,"number");b.keyMap["vim-insert"]={"Ctrl-N":"autocomplete","Ctrl-P":"autocomplete",Enter:function(bG){var bH=b.commands.newlineAndIndentContinueComment||b.commands.newlineAndIndent;bH(bG)},fallthrough:["default"],attach:u,detach:j,call:a7};b.keyMap["vim-replace"]={Backspace:"goCharLeft",fallthrough:["vim-insert"],attach:u,detach:j,call:a7};function I(bO,bI,bJ,bG){var bQ=s.registerController.getRegister(bG);if(bG==":"){if(bQ.keyBuffer[0]){n.processCommand(bO,bQ.keyBuffer[0])}bJ.isPlaying=false;return}var bH=bQ.keyBuffer;var bM=0;bJ.isPlaying=true;bJ.replaySearchQueries=bQ.searchQueries.slice(0);for(var bK=0;bK<bH.length;bK++){var bR=bH[bK];var bL,bP;while(bR){bL=(/<\w+-.+?>|<\w+>|./).exec(bR);bP=bL[0];bR=bR.substring(bL.index+bP.length);b.Vim.handleKey(bO,bP,"macro");if(bI.insertMode){var bN=bQ.insertModeChanges[bM++].changes;s.macroModeState.lastInsertModeChanges.changes=bN;aw(bO,bN,1);x(bO)}}}bJ.isPlaying=false}function J(bJ,bG){if(bJ.isPlaying){return}var bI=bJ.latestRegister;var bH=s.registerController.getRegister(bI);if(bH){bH.pushText(bG)}}function aq(bI){if(bI.isPlaying){return}var bH=bI.latestRegister;var bG=s.registerController.getRegister(bH);if(bG&&bG.pushInsertModeChanges){bG.pushInsertModeChanges(bI.lastInsertModeChanges)}}function P(bJ,bI){if(bJ.isPlaying){return}var bH=bJ.latestRegister;var bG=s.registerController.getRegister(bH);if(bG&&bG.pushSearchQuery){bG.pushSearchQuery(bI)}}function bm(bH,bG){var bJ=s.macroModeState;var bI=bJ.lastInsertModeChanges;if(!bJ.isPlaying){while(bG){bI.expectCursorActivityForChange=true;if(bG.origin=="+input"||bG.origin=="paste"||bG.origin===undefined){var bK=bG.text.join("\n");bI.changes.push(bK)}bG=bG.next}}}function ac(bG){var bH=bG.state.vim;if(bH.insertMode){var bJ=s.macroModeState;if(bJ.isPlaying){return}var bI=bJ.lastInsertModeChanges;if(bI.expectCursorActivityForChange){bI.expectCursorActivityForChange=false}else{bI.changes=[]}}else{if(!bG.curOp.isVimOp){t(bG,bH)}}if(bH.visualMode){ae(bG)}}function ae(bG){var bH=bG.state.vim;var bJ=ab(bG,D(bH.sel.head));var bI=E(bJ,0,1);if(bH.fakeCursor){bH.fakeCursor.clear()}bH.fakeCursor=bG.markText(bJ,bI,{className:"cm-animate-fat-cursor"})}function t(bG,bH){var bI=bG.getCursor("anchor");var bJ=bG.getCursor("head");if(bH.visualMode&&!bG.somethingSelected()){aW(bG,false)}else{if(!bH.visualMode&&!bH.insertMode&&bG.somethingSelected()){bH.visualMode=true;bH.visualLine=false;b.signal(bG,"vim-mode-change",{mode:"visual"})}}if(bH.visualMode){var bK=!aR(bJ,bI)?-1:0;var bL=aR(bJ,bI)?-1:0;bJ=E(bJ,0,bK);bI=E(bI,0,bL);bH.sel={anchor:bI,head:bJ};aU(bG,bH,"<",az(bJ,bI));aU(bG,bH,">",be(bJ,bI))}else{if(!bH.insertMode){bH.lastHPos=bG.getCursor().ch}}}function bp(bG){this.keyName=bG}function X(bK){var bJ=s.macroModeState;var bI=bJ.lastInsertModeChanges;var bH=b.keyName(bK);if(!bH){return}function bG(){bI.changes.push(new bp(bH));return true}if(bH.indexOf("Delete")!=-1||bH.indexOf("Backspace")!=-1){b.lookupKey(bH,"vim-insert",bG)}}function z(bO,bJ,bH,bG){var bL=s.macroModeState;bL.isPlaying=true;var bP=!!bJ.lastEditActionCommand;var bM=bJ.inputState;function bI(){if(bP){bg.processAction(bO,bJ,bJ.lastEditActionCommand)}else{bg.evalInput(bO,bJ)}}function bN(bR){if(bL.lastInsertModeChanges.changes.length>0){bR=!bJ.lastEditActionCommand?1:bR;var bQ=bL.lastInsertModeChanges;aw(bO,bQ.changes,bR)}}bJ.inputState=bJ.lastEditInputState;if(bP&&bJ.lastEditActionCommand.interlaceInsertRepeat){for(var bK=0;bK<bH;bK++){bI();bN(1)}}else{if(!bG){bI()}bN(bH)}bJ.inputState=bM;if(bJ.insertMode&&!bG){x(bO)}bL.isPlaying=false}function aw(bR,bQ,bH){function bN(bT){if(typeof bT=="string"){b.commands[bT](bR)}else{bT(bR)}return true}var bP=bR.getCursor("head");var bG=s.macroModeState.lastInsertModeChanges.inVisualBlock;if(bG){var bL=bR.state.vim;var bI=bL.lastSelection;var bK=bj(bI.anchor,bI.head);aX(bR,bP,bK.line+1);bH=bR.listSelections().length;bR.setCursor(bP)}for(var bM=0;bM<bH;bM++){if(bG){bR.setCursor(E(bP,bM,0))}for(var bJ=0;bJ<bQ.length;bJ++){var bO=bQ[bJ];if(bO instanceof bp){b.lookupKey(bO.keyName,"vim-insert",bN)}else{var bS=bR.getCursor();bR.replaceRange(bO,bS,bS)}}}if(bG){bR.setCursor(E(bP,0,1))}}B();return aS};b.Vim=f()});
    }

    // call the function to transform the CodeMirror Instances
    do_magic();
    loopintval = window.setInterval(do_magic,5000);

    // when a panel is added in the widget editor...start over...
    jQuery("input[type=checkbox]").change(function(){
      window.clearInterval(loopintval);
      jQuery(this).off();
      start();
    });

    /*
    // TODO: Fix this...
    // if they change another widget...start over...
    jQuery("input[name=widget]").change(function(){
      window.clearInterval(loopintval);
      jQuery(this).off();
      start();
    });
    */

  },500);

}


  // function that applies the monokai class and enables the keymap
  function do_magic(){

    // if we have already successfully ran...then good...
    if (success) return;

    // setup the editors
    var editors = jQuery(".CodeMirror");
    for (var i=0; i < editors.length; i++){

      // add the monokai css class
      if (!jQuery(editors[i]).hasClass("cm-s-monokai")) jQuery(editors[i]).addClass("cm-s-monokai");

      // for the studio...remove their style they have created...
      jQuery(editors[i]).removeClass("cm-s-snc");
      jQuery(".cm-s-snc").removeClass("cm-s-snc");
      jQuery(editors[i]).removeClass("cm-s-snc_readonly"); // the vim plugin won't go out of preview mode if it is readonly

      // get the CodeMirror instances
      var cm = editors[i].CodeMirror;
      if (typeof cm == "undefined") continue;

      // if we found one that we can use...then success is true
      success = true;

      // tell codemirror to enable vim keymap
      if (cm.getOption("keyMap") != "vim" && cm.getOption("keyMap") !== 'vim-insert')
        cm.setOption("keyMap", "vim");

      if (!cm.getOption("showCursorWhenSelecting"))
        cm.setOption("showCursorWhenSelecting", true);


      // ANNND...BOOOOM GOES THE DYNAMITE!
    }
  }

  start();

})();
